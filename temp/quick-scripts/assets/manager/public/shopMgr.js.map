{"version":3,"sources":["shopMgr.ts"],"names":[],"mappings":";;;;;AAAA,6DAAwD;AAGxD,uDAAsD;AAEtD,yCAAoC;AACpC,uCAAkC;AAClC,kCAAiC;AACjC,IAAI,SAAS,GAAG,mBAAS,CAAC,WAAW,EAAE,CAAC;AACxC,IAAI,QAAQ,GAAG,kBAAQ,CAAC,WAAW,EAAE,CAAC;AACtC;IAAqC,2BAAO;IAcxC;QAAA,YACI,iBAAO,SAMV;QApBM,eAAS,GAAW,IAAI,CAAA;QACxB,iBAAW,GAAY,KAAK,CAAC;QAC7B,gBAAU,GAAY,KAAK,CAAC;QAE5B,eAAS,GAAQ,IAAI,CAAA;QACrB,aAAO,GAAQ,EAAE,CAAA;QACjB,cAAQ,GAAQ,EAAE,CAAA;QAClB,iBAAW,GAAQ,EAAE,CAAA;QACrB,iBAAW,GAAQ,EAAE,CAAA;QACrB,cAAQ,GAAQ,EAAE,CAAA;QAClB,yBAAmB,GAAW,IAAI,CAAC;QACnC,kBAAY,GAAW,IAAI,CAAC;QAC5B,mBAAa,GAAG,IAAI,CAAC;QAGxB,KAAI,CAAC,MAAM,GAAG;YACV,wBAAwB,EAAE,KAAI,CAAC,sBAAsB;YACrD,wBAAwB,EAAE,KAAI,CAAC,sBAAsB;YACrD,qBAAqB,EAAE,KAAI,CAAC,mBAAmB;SAClD,CAAC;;IACN,CAAC;IACD,kCAAgB,GAAhB;QACI,OAAO,IAAI,CAAC,aAAa,CAAC;IAC9B,CAAC;IACD,wCAAsB,GAAtB,UAAuB,GAAY;QAC/B,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QACnC,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACrC,IAAI,SAAS,GAAG,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACtC,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACrC,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,aAAK,CAAC,SAAS,CAAC,CAAA;QACjD,QAAQ,QAAQ,EAAE;YACd,KAAK,aAAK,CAAC,SAAS;gBAChB,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAA;gBACxC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;gBACvB,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC;gBAC7C,MAAM;YACV,KAAK,aAAK,CAAC,cAAc;gBACrB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBACxB,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC;gBAC9B,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC;gBAC7C,MAAM;YACV;gBACI,MAAM;SACb;IACL,CAAC;IACD,0BAAQ,GAAR,UAAS,IAAI,EAAE,EAAE;QACb,IAAI,KAAK,GAAG,qBAAqB,CAAC;QAClC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC;IACrD,CAAC;IACD,qCAAmB,GAAnB,UAAoB,GAAY;QAC5B,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,GAAG,CAAC,CAAA;IAC3C,CAAC;IACD,0BAAQ,GAAR;QACI,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC;YAC3D,EAAE,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,CAAA;YACtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC5C,QAAQ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE;oBAC5B,KAAK,CAAC;wBACF,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;wBACrC,MAAM;oBACV,KAAK,CAAC;wBACF,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;wBACtC,MAAM;oBACV,KAAK,CAAC;wBACF,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;wBACzC,MAAM;oBACV,KAAK,CAAC;wBACF,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;wBACtC,MAAM;oBACV,KAAK,CAAC;wBACF,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;wBACzC,MAAM;oBACV;wBACI,MAAM;iBACb;aACJ;SACJ;IACL,CAAC;IACD,gCAAc,GAAd,UAAe,IAAI,EAAE,SAAS;QAC1B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;QACjB,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,WAAW,CAAC;QAC5C,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAA;QACrC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC3C,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YAC3B,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACjC,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC;YACtC,GAAG,CAAC,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,CAAA;YACzE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC;YACzB,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC;YACpC,GAAG,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAI,IAAI;YAClD,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,UAAU;SAC1D;QACD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;IAC9B,CAAC;IACD,6BAAW,GAAX,UAAY,QAA0B;QAA1B,yBAAA,EAAA,WAAW,aAAK,CAAC,SAAS;QAClC,IAAI,KAAK,GAAG,wBAAwB,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC,CAAC;IACnD,CAAC;IACD,WAAW;IACX,gCAAc,GAAd,UAAe,QAA0B;QAA1B,yBAAA,EAAA,WAAW,aAAK,CAAC,SAAS;QACrC,IAAI,KAAK,GAAG,wBAAwB,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,UAAU,EAAE,QAAQ,EAAE,CAAC,CAAC;IACnD,CAAC;IACD,wCAAsB,GAAtB,UAAuB,GAAY;QAC/B,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACrC,IAAI,SAAS,GAAG,GAAG,CAAC,aAAa,CAAC,iBAAO,CAAC,gBAAgB,CAAC,CAAC;QAC5D,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QACrC,QAAQ,QAAQ,EAAE;YACd,KAAK,aAAK,CAAC,SAAS;gBAChB,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC;gBAC7C,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAA;gBAChC,MAAM;YACV,KAAK,aAAK,CAAC,cAAc;gBACrB,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC;gBAC7C,IAAI,CAAC,aAAa,GAAG,QAAQ,CAAC;gBAC9B,MAAM;YACV;gBACI,MAAM;SACb;IACL,CAAC;IACD,8BAAY,GAAZ,UAAa,IAAY;QACrB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;IAC1B,CAAC;IAGa,mBAAW,GAAzB;QACI,IAAI,OAAO,CAAC,SAAS,IAAI,IAAI,EAAE;YAC3B,OAAO,CAAC,SAAS,GAAG,IAAI,OAAO,EAAE,CAAC;SACrC;QACD,OAAO,OAAO,CAAC,SAAS,CAAC;IAC7B,CAAC;IAPD,OAAO;IACQ,iBAAS,GAAY,IAAI,CAAC;IAO7C,cAAC;CAvID,AAuIC,CAvIoC,iBAAO,GAuI3C;kBAvIoB,OAAO","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\manager\\public","sourcesContent":["import BaseMgr from \"../../framework/baseClass/BaseMgr\";\r\nimport Package from \"../../framework/net/package\";\r\n\r\nimport { dataids } from \"../../framework/net/dataids\";\r\nimport GameNet from \"../../framework/modules/GameNet\";\r\nimport EffectMgr from \"./effectMgr\";\r\nimport TableMgr from \"./tableMgr\";\r\nimport { enums } from \"../enums\";\r\nlet effectMgr = EffectMgr.getInstance();\r\nlet tableMgr = TableMgr.getInstance();\r\nexport default class ShopMgr extends BaseMgr {\r\n    public shopState: string = null\r\n    public isInitGuild: boolean = false;\r\n    public isInitShop: boolean = false;\r\n\r\n    public shopTabal: any = null\r\n    public boxShop: any = []\r\n    public goldShop: any = []\r\n    public crystalShop: any = []\r\n    public diamondShop: any = []\r\n    public cardShop: any = []\r\n    public cardShopRefreshTime: number = null;\r\n    public refreshCount: number = null;\r\n    public guildShopInfo = null;\r\n    constructor() {\r\n        super();\r\n        this.routes = {\r\n            'plaza.data.reqShopInfo': this.plaza_data_reqShopInfo,\r\n            'plaza.shop.refreshShop': this.plaza_shop_refreshShop,\r\n            'plaza.shop.buyGoods': this.plaza_shop_buyGoods,\r\n        };\r\n    }\r\n    getGuildShopInfo() {\r\n        return this.guildShopInfo;\r\n    }\r\n    plaza_data_reqShopInfo(msg: Package): void {\r\n        console.log(\"--------商店数据-------\");\r\n        this.initData();\r\n        let shopType = msg.getDataByType(37);\r\n        let shopTimes = msg.getDataByType(38);\r\n        let shopInfo = msg.getDataByType(36);\r\n        console.log(shopType, shopTimes, enums.Shop_Card)\r\n        switch (shopType) {\r\n            case enums.Shop_Card:\r\n                this.cardShopUpdate(shopInfo, shopTimes)\r\n                this.isInitShop = true;\r\n                console.log(\"--------神秘商店-------\", shopInfo);\r\n                break;\r\n            case enums.GuildShop_Card:\r\n                this.isInitGuild = true;\r\n                this.guildShopInfo = shopInfo;\r\n                console.log(\"--------公会商店-------\", shopInfo);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    buyGoods(type, id) {\r\n        let route = 'plaza.shop.buyGoods';\r\n        this.send_msg(route, { 'type': type, 'id': id });\r\n    }\r\n    plaza_shop_buyGoods(msg: Package) {\r\n        console.log(\"plaza_shop_buyGoods\", msg)\r\n    }\r\n    initData() {\r\n        if (!this.shopTabal) {\r\n            this.shopTabal = this.getConfigSync(\"shangdian_shop\").json;\r\n            cc.log(\"----商店表格----\", this.shopTabal)\r\n            for (let i = 0; i < this.shopTabal.length; i++) {\r\n                switch (this.shopTabal[i].type) {\r\n                    case 1:\r\n                        this.boxShop.push(this.shopTabal[i]);\r\n                        break;\r\n                    case 2:\r\n                        this.goldShop.push(this.shopTabal[i]);\r\n                        break;\r\n                    case 3:\r\n                        this.crystalShop.push(this.shopTabal[i]);\r\n                        break;\r\n                    case 4:\r\n                        this.cardShop.push(this.shopTabal[i]);\r\n                        break;\r\n                    case 5:\r\n                        this.diamondShop.push(this.shopTabal[i]);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    cardShopUpdate(info, shopTimes) {\r\n        console.log(info)\r\n        this.cardShopRefreshTime = info.refreshTime;\r\n        console.log(this.cardShopRefreshTime)\r\n        this.refreshCount = info.refreshCount;\r\n        for (let i = 0; i < this.cardShop.length; i++) {\r\n            let obj = this.cardShop[i];\r\n            obj.shopTimes = shopTimes[i + 1];\r\n            obj.amount = info.items[i + 1].amount;\r\n            obj.card = tableMgr.search('teji_teji', { id: info.items[i + 1].itemId })\r\n            obj.name = obj.card.name;\r\n            obj.price = info.items[i + 1].price;\r\n            obj.discount = info.items[i + 1].discount;    //折扣\r\n            obj.priceType = info.items[i + 1].priceType; // 0金币 1水晶\r\n        }\r\n        console.log(this.cardShop)\r\n    }\r\n    reqShopInfo(shopType = enums.Shop_Card) {\r\n        let route = 'plaza.data.reqShopInfo';\r\n        this.send_msg(route, { 'shopType': shopType });\r\n    }\r\n    //新增刷新商店的参数\r\n    reqRefreshShop(shopType = enums.Shop_Card) {\r\n        let route = 'plaza.shop.refreshShop';\r\n        this.send_msg(route, { 'shopType': shopType });\r\n    }\r\n    plaza_shop_refreshShop(msg: Package): void {\r\n        let shopType = msg.getDataByType(37);\r\n        let shopTimes = msg.getDataByType(dataids.ID_USER_MONEYFEN);\r\n        let shopInfo = msg.getDataByType(36);\r\n        switch (shopType) {\r\n            case enums.Shop_Card:\r\n                console.log(\"--------神秘商店-------\", shopInfo);\r\n                this.cardShopUpdate(shopInfo, 0)\r\n                break;\r\n            case enums.GuildShop_Card:\r\n                console.log(\"--------公会商店-------\", shopInfo);\r\n                this.guildShopInfo = shopInfo;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    setShopState(name: string) {\r\n        this.shopState = name;\r\n    }\r\n    // 单例处理\r\n    private static _instance: ShopMgr = null;\r\n    public static getInstance(): ShopMgr {\r\n        if (ShopMgr._instance == null) {\r\n            ShopMgr._instance = new ShopMgr();\r\n        }\r\n        return ShopMgr._instance;\r\n    }\r\n}\r\n\r\n"]}