{"version":3,"sources":["roleUnlock.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\role","sourcesContent":["import BaseModel from \"../../../../framework/baseClass/BaseModel\";\nimport BaseView from \"../../../../framework/baseClass/BaseView\";\nimport BaseCtrl from \"../../../../framework/baseClass/BaseCtrl\";\nimport { role } from \"../../../../manager/public/interface/iRole\";\nimport UserMgr from \"../../../../manager/public/userMgr\";\nimport RoleMgr from \"../../../../manager/public/roleMgr\";\n\n/*\nauthor: 陈斌杰\n日期:2018-11-15 13:53:27\n*/\n\n//MVC模块,\nconst { ccclass, property } = cc._decorator;\nlet ctrl: RoleUnlockCtrl;\n//模型，数据处理\nclass Model extends BaseModel {\n\tconstructor() {\n\t\tsuper();\n\t}\n\tpublic roleData: role = <role>{};\n\tpublic ChipUnlockState: boolean = false;\t\t//碎片是否可以解锁\n\tpublic unlockState: boolean = false;\t\t\t//金钱是否可以解锁\n\n\t//初始化角色数据\n\tpublic initRoleData(data: any): void {\n\t\tthis.roleData = data;\n\t}\n}\n//视图, 界面显示或动画，在这里完成\nclass View extends BaseView {\n\tprotected model: Model;\n\tprotected node: cc.Node;\n\tpublic ui = {\n\t\tbtn_close: ctrl.btn_close,\t\t\t\t//关闭按钮\n\t\tbtn_chip: ctrl.btn_chip,\t\t\t\t//碎片解锁按钮\n\t\tspendChip: ctrl.spendChip,\t\t\t\t//花费的碎片数量\n\t\tbtn_lock: ctrl.btn_lock,\t\t\t\t//解锁按钮\n\t\tspendMoney: ctrl.spendMoney,\t\t\t\t//花费的金钱数量\n\t\tchipCount: ctrl.chipCount,\t\t\t\t//碎片数量显示\n\t}\n\tconstructor(model) {\n\t\tsuper(model);\n\t\tthis.node = ctrl.node;\n\t\tthis.initUi();\n\t}\n\t//初始化ui\n\tpublic initUi() {\n\n\t}\n\n\t//初始化解锁界面UI显示\n\tpublic initUnlock(): void {\n\t\tthis.ui.spendChip.string = \"X \" + this.model.roleData.roleChipNum.toString();\n\t\tif (this.model.roleData.roleChipNum != 0 && this.model.roleData.userRoleChipNum >= this.model.roleData.roleChipNum) {\n\t\t\tthis.loadImage(\"btn_unlock\").then((sprf) => {\n\t\t\t\tthis.ui.btn_chip.getComponent(cc.Sprite).spriteFrame = sprf;\n\t\t\t});\n\t\t\tthis.model.ChipUnlockState = true;\n\t\t}\n\t\tthis.ui.chipCount.string = this.model.roleData.userRoleChipNum.toString() + \"个\";\n\t\tthis.moneyUnlock();\n\t}\n\n\t//金钱解锁界面显示\n\tpublic moneyUnlock(): void {\n\t\tlet uiName = null;\n\t\tlet spend = 0;\n\t\tlet money = UserMgr.getInstance().userMoney;\n\t\tif (this.model.roleData.spendGold) {\n\t\t\tuiName = \"gold\";\n\t\t\tspend = this.model.roleData.spendGold;\n\t\t\tthis.refreshUnlockBtn(money.gold,spend);\n\t\t} else if (this.model.roleData.spendCrystal) {\n\t\t\tuiName = \"crystal\";\n\t\t\tspend = this.model.roleData.spendCrystal;\n\t\t\tthis.refreshUnlockBtn(money.crystal,spend);\n\t\t} else if (this.model.roleData.spendDiamond && !this.model.roleData.vipLimite) {\n\t\t\tuiName = \"diamond\";\n\t\t\tspend = this.model.roleData.spendDiamond;\n\t\t\tthis.refreshUnlockBtn(money.diamond,spend);\n\t\t} else if (this.model.roleData.vipLimite) {\n\t\t\tthis.ui.spendMoney.node.parent.getComponent(cc.Sprite).spriteFrame = null;\n\t\t\tthis.ui.spendMoney.string = \"VIP\" + this.model.roleData.vipLimite.toString();\n\t\t\tthis.ui.spendMoney.node.parent.x = 30;\n\t\t\tthis.refreshUnlockBtn(money.diamond,spend);\n\t\t\treturn;\n\t\t}\n\t\tthis.model.ChipUnlockState = true;\n\t\tthis.ui.spendMoney.string = \"X \" + spend.toString();\n\t\tthis.ui.spendMoney.node.parent.x -= spend.toString().length * 10;\n\t\tthis.loadImage(uiName, true).then((sprf) => {\n\t\t\tthis.ui.spendMoney.node.parent.getComponent(cc.Sprite).spriteFrame = sprf;\n\t\t});\n\t}\n\n\t//解锁按钮显示\n\tpublic refreshUnlockBtn(data: any, spendMoney: number): void {\n\t\tif (data < spendMoney) {\n\t\t\tthis.ui.btn_lock.getComponent(cc.Button).interactable = false;\n\t\t} else {\n\t\t\tthis.ui.btn_lock.getComponent(cc.Button).interactable = true;\n\t\t}\n\t}\n}\n//c, 控制\n@ccclass\nexport default class RoleUnlockCtrl extends BaseCtrl {\n\tprotected view: View;\n\tprotected model: Model;\n\t//这边去声明ui组件\n\t@property(cc.Button)\n\tbtn_close: cc.Button = null;\n\t@property(cc.Node)\n\tbtn_chip: cc.Node = null;\n\t@property(cc.Label)\n\tspendChip: cc.Label = null;\n\t@property(cc.Node)\n\tbtn_lock: cc.Node = null;\n\t@property(cc.Label)\n\tspendMoney: cc.Label = null;\n\t@property(cc.Label)\n\tchipCount: cc.Label = null;\n\t//声明ui组件end\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\n\n\n\tonLoad() {\n\t\t// 控制器\n\t\tctrl = this;\n\t\t// 创建mvc模式中模型和视图\n\t\tthis.initMvc(Model, View);\n\t}\n\n\t//定义网络事件\n\tprotected defineNetEvents() {\n\t\tthis.n_events = {};\n\t}\n\t//定义全局事件\n\tprotected defineGlobalEvents() {\n\t\tthis.g_events = {};\n\t}\n\t//绑定操作的回调\n\tconnectUi() {\n\t\tthis.connect(\"click\", this.ui.btn_close, () => {\n\t\t\tthis.closeModule(\"roleUnlock\");\n\t\t}, \"关闭解锁角色界面\");\n\t\tthis.connect(\"click\",this.ui.btn_lock,()=>{\n\t\t\tRoleMgr.getInstance().sendReqUnlockRole(this.model.roleData.roleId);\n\t\t\tthis.closeModule(\"roleUnlock\");\n\t\t},\"发送金钱解锁角色服务请求\");\n\t}\n\t//网络事件回调begin\n\t//end\n\t//全局事件回调begin\n\t//end\n\t//按钮或任何控件操作的回调begin\n\t//end\n\n\t// update(dt) {}\n\n\t//初始化解锁界面数据和UI显示\n\tpublic initUnlock(data: any): void {\n\t\tthis.model.initRoleData(data);\n\t\tthis.view.initUnlock();\n\t}\n\n\tonDestroy() {\n\t\tsuper.onDestroy();\n\t}\n}"]}