{"version":3,"sources":["day.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\signIn","sourcesContent":["import BaseModel from \"../../../../framework/baseClass/BaseModel\";\nimport BaseView from \"../../../../framework/baseClass/BaseView\";\nimport BaseCtrl from \"../../../../framework/baseClass/BaseCtrl\";\nimport { signIn } from \"../../../../manager/public/interface/iSignInfo\";\nimport { enums } from \"../../../../manager/enums\";\nimport SignInMgr from \"../../../../manager/public/signInMgr\";\nimport UserMgr from \"../../../../manager/public/userMgr\";\n\n/*\nauthor: 陈斌杰\n日期:2018-11-21 10:38:16\n*/\n\n//MVC模块,\nconst { ccclass, property } = cc._decorator;\nlet ctrl: DayCtrl;\n//模型，数据处理\nclass Model extends BaseModel {\n\tconstructor() {\n\t\tsuper();\n\t}\n\tpublic signInData: signIn = <signIn>{};\n\tpublic isNoDoubleSignIn: boolean = false;\t\t//是否放弃双倍签到\n\n\t//设置第N天签到数据\n\tpublic setSignInData(data: any): void {\n\t\tthis.signInData = data;\n\t}\n\n\t//设置数据已经签到\n\tpublic setDataIsSignIn(): void {\n\t\tthis.signInData.isSignIn = true;\n\t\tthis.signInData.again_signIn = false;\n\t}\n}\n//视图, 界面显示或动画，在这里完成\nclass View extends BaseView {\n\tprotected model: Model;\n\tprotected node: cc.Node;\n\tpublic ui = {\n\t\tbg: ctrl.bg,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//签到背景\n\t\trewark_Ico: ctrl.rewark.getChildByName(\"ico\").getComponent(cc.Sprite),\t\t//签到奖励图片\n\t\trewark_amount: ctrl.rewark.getChildByName(\"amount\").getComponent(cc.Label),\t//签到奖励图片\n\t\thook: ctrl.hook,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//已签到标识\n\t\tagain_signIn: ctrl.again_signIn,\t\t\t\t\t\t\t\t\t\t\t//可补签标识\n\t\tvipIco: ctrl.vipIco,\t\t\t\t\t\t\t\t\t\t\t\t\t\t//vip角标\n\t\tbnt_signIn: ctrl.bnt_signIn,\t\t\t\t\t\t\t\t\t\t\t\t//签到按钮\n\t}\n\tconstructor(model) {\n\t\tsuper(model);\n\t\tthis.node = ctrl.node;\n\t\tthis.initUi();\n\t}\n\t//初始化ui\n\tpublic initUi() {\n\t\tthis.ui.rewark_Ico.spriteFrame = null;\n\t\tthis.ui.rewark_amount.string = \"\";\n\t\tthis.ui.hook.active = false;\n\t\tthis.ui.again_signIn.active = false;\n\t\tthis.ui.vipIco.active = false;\n\t}\n\n\t//初始化第N天签到UI\n\tpublic initSignInUI(): void {\n\t\tlet signInData = this.model.signInData;\n\t\tlet icoName = null;\n\t\tswitch (signInData.rewark.type) {\n\t\t\tcase enums.Get_Gold:\n\t\t\t\ticoName = \"gold\";\n\t\t\t\tbreak;\n\t\t\tcase enums.Get_Crystal:\n\t\t\t\ticoName = \"crystal\";\n\t\t\t\tbreak;\n\t\t\tcase enums.Get_Price:\n\t\t\t\ticoName = \"diamond\";\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\tif (icoName != null) {\n\t\t\tthis.loadImage(icoName, true).then((sprf) => {\n\t\t\t\tthis.ui.rewark_Ico.spriteFrame = sprf;\n\t\t\t});\n\t\t}\n\t\tthis.ui.rewark_amount.string = signInData.rewark.amount.toString();\n\t\tthis.ui.hook.active = signInData.isSignIn;\n\t\tthis.ui.again_signIn.active = signInData.again_signIn;\n\t\tif (signInData.vipLv == 0) {\n\t\t\tthis.ui.vipIco.active = false;\n\t\t} else if (signInData.vipLv > 1) {\n\t\t\tthis.ui.vipIco.active = true;\n\t\t\tthis.loadImage(`vipIco_${signInData.vipLv}`).then((sprf) => {\n\t\t\t\tthis.ui.vipIco.getComponent(cc.Sprite).spriteFrame = sprf;\n\t\t\t});\n\t\t}\n\t}\n\n\t//刷新签到UI\n\tpublic refreshSignIn(): void {\n\t\tthis.ui.hook.active = this.model.signInData.isSignIn;\n\t\tthis.ui.again_signIn.active = this.model.signInData.again_signIn;\n\t}\n}\n//c, 控制\n@ccclass\nexport default class DayCtrl extends BaseCtrl {\n\tprotected view: View;\n\tprotected model: Model;\n\t//这边去声明ui组件\n\t@property(cc.Node)\n\tbg: cc.Node = null;\n\t@property(cc.Node)\n\trewark: cc.Node = null;\n\t@property(cc.Node)\n\thook: cc.Node = null;\n\t@property(cc.Node)\n\tagain_signIn: cc.Node = null;\n\t@property(cc.Node)\n\tvipIco: cc.Node = null;\n\t@property(cc.Node)\n\tbnt_signIn: cc.Node = null;\n\t//声明ui组件end\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\n\n\n\tonLoad() {\n\t\t// 控制器\n\t\tctrl = this;\n\t\t// 创建mvc模式中模型和视图\n\t\tthis.initMvc(Model, View);\n\t}\n\n\t//定义网络事件\n\tprotected defineNetEvents() {\n\t\tthis.n_events = {};\n\t}\n\t//定义全局事件\n\tprotected defineGlobalEvents() {\n\t\tthis.g_events = {};\n\t}\n\t//绑定操作的回调\n\tconnectUi() {\n\t\tthis.connect(\"click\", this.ui.bnt_signIn, () => {\n\t\t\tthis.signInBtn();\n\t\t}, \"点击签到\");\n\t}\n\t//网络事件回调begin\n\t//end\n\t//全局事件回调begin\n\t//end\n\t//按钮或任何控件操作的回调begin\n\t//end\n\n\t//初始化第N天签到\n\tpublic initSignIn(data: any): void {\n\t\tthis.model.setSignInData(data);\n\t\tthis.view.initSignInUI();\n\t}\n\n\t//刷新签到UI显示\n\tpublic refreshUI(): void {\n\t\tthis.model.setDataIsSignIn();\n\t\tthis.view.refreshSignIn();\n\t}\n\n\t//签到按钮处理\n\tpublic signInBtn(): void {\n\t\tlet isCanSignIn = SignInMgr.getInstance().getIsCanSignIn(this.model.signInData.signInDay);\n\t\tif (this.model.signInData.isSignIn) {\n\t\t\treturn;\n\t\t}\n\t\t//签到\n\t\tif (isCanSignIn) {\t//今天还没签到可签到\n\t\t\t//vip双倍签到处理\n\t\t\tif (this.model.signInData.vipLv && this.model.signInData.vipLv > UserMgr.getInstance().user.vipLv && !this.model.isNoDoubleSignIn) {\n\t\t\t\tthis.gemit(\"openDoubleSignIn\",this.model.signInData.signInDay);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tSignInMgr.getInstance().sendReqSignIn();\n\t\t\treturn;\n\t\t}\n\t\t//补签\t\t补签次数不等于0  可补签  前面的天数已经补签完\n\t\tlet canSignIn = SignInMgr.getInstance().getIsCanShowRepairSignIn(this.model.signInData.signInDay);\n\t\tif (!canSignIn) {\n\t\t\tconsole.log(\"----------------当前还有未补签天数，请先补签前面的天数------------------\");\n\t\t}\n\t\tif (this.model.signInData.again_signIn && canSignIn) {\n\t\t\t//vip双倍签到处理\n\t\t\tif (this.model.signInData.vipLv && this.model.signInData.vipLv > UserMgr.getInstance().user.vipLv && !this.model.isNoDoubleSignIn) {\n\t\t\t\tthis.gemit(\"openDoubleSignIn\",this.model.signInData.signInDay);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.gemit(\"openRepairSignIn\",this.model.signInData.signInDay);\n\t\t}\n\t}\n\n\tonDestroy() {\n\t\tsuper.onDestroy();\n\t}\n}"]}