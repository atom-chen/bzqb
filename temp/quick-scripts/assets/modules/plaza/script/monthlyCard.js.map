{"version":3,"sources":["monthlyCard.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script","sourcesContent":["import BaseModel from \"../../../framework/baseClass/BaseModel\";\nimport BaseView from \"../../../framework/baseClass/BaseView\";\nimport BaseCtrl from \"../../../framework/baseClass/BaseCtrl\";\nimport cardMgr from \"../../../manager/public/cardMgr\";\nimport ModuleMgr from \"../../../framework/modules/ModuleMgr\";\n/*\nauthor: 蒙磊\n日期:2018-11-09 15:52:44\n*/\n\n//MVC模块,\nconst { ccclass, property } = cc._decorator;\nlet ctrl: MonthlyCardCtrl;\n//模型，数据处理\nclass Model extends BaseModel {\n\tisHave: any = null;\n\tisOpenBox: any = null;\n\tcreateTime: any = null;\n\tclosingDate: string = null;\n\tconstructor() {\n\t\tsuper();\n\t}\n\tinitData() {\n\t\tthis.isHave = cardMgr.getInstance().monthlyCardInfo.isHave;\n\t\tthis.isOpenBox = cardMgr.getInstance().monthlyCardInfo.isOpenBox;\n\t\tthis.createTime = cardMgr.getInstance().monthlyCardInfo.createTime;\n\t}\n\tsetClosingDate() {\n\t\tvar endTime = this.createTime + cardMgr.getInstance().monthlyCardTime;\n\t\tvar time = new Date(endTime);\n\t\tlet year = time.getFullYear();\n\t\tlet month = time.getMonth() + 1;\n\t\tlet date = time.getDate();\n\t\tthis.closingDate = year + \"年\" + month + \"月\" + date + \"日结束\";\n\t}\n}\n//视图, 界面显示或动画，在这里完成\nclass View extends BaseView {\n\tprotected model: Model;\n\tprotected node: cc.Node;\n\tpublic ui = {\n\t\t//在这里声明ui\n\t\tbtn_close: ctrl.btn_close,\n\t\tbtn_buy: ctrl.btn_buy,\n\t\tbtn_receiveReward: ctrl.btn_receiveReward,\n\t\tbtn_beReceived: ctrl.btn_beReceived,\n\t\tnote_closingDate: ctrl.note_closingDate,\n\t\tlab_closingDate: ctrl.lab_closingDate,\n\t}\n\tconstructor(model) {\n\t\tsuper(model);\n\t\tthis.node = ctrl.node;\n\t\tthis.initUi();\n\t}\n\t//初始化ui\n\tpublic initUi() {\n\t}\n\t//显示label内容\n\tshowLabelString(obj: cc.Label, content: string) {\n\t\tobj.string = content;\n\t}\n}\n//c, 控制\n@ccclass\nexport default class MonthlyCardCtrl extends BaseCtrl {\n\tprotected view: View;\n\tprotected model: Model;\n\t//这边去声明ui组件\n\t@property(cc.Node)\n\tbtn_close: cc.Node = null;\n\t@property(cc.Node)\n\tbtn_buy: cc.Node = null;\n\t@property(cc.Node)\n\tbtn_receiveReward: cc.Node = null;\n\t@property(cc.Node)\n\tbtn_beReceived: cc.Node = null;\n\t//note\n\t@property(cc.Node)\n\tnote_closingDate: cc.Node = null;\n\t//label\n\t@property(cc.Label)\n\tlab_closingDate: cc.Label = null;\n\t//声明ui组件end\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\n\n\n\tonLoad() {\n\t\t// 控制器\n\t\tctrl = this;\n\t\t// 创建mvc模式中模型和视图\n\t\tthis.initMvc(Model, View);\n\t\tthis.initData();\n\t}\n\tinitData() {\n\t\tthis.model.initData();\n\t\tif (this.model.isHave == 0) {\n\t\t\tthis.btn_buy.active = true;\n\t\t}\n\t\telse {\n\t\t\tthis.model.setClosingDate();\n\t\t\tthis.view.showLabelString(this.ui.lab_closingDate,this.model.closingDate)\n\t\t\tthis.note_closingDate.active = true;\n\t\t\tif (this.model.isOpenBox == 0) {\n\t\t\t\tthis.btn_receiveReward.active = true;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.btn_beReceived.active = true;\n\t\t\t}\n\t\t}\n\t}\n\t//定义网络事件\n\tprotected defineNetEvents() {\n\t\tthis.n_events = {\n\t\t\t\"plaza.privilege.buyMonthlyCard\": this.buyMonthlyCard,\n\t\t\t\"plaza.privilege.recMonthlyDailyBox\":this.recMonthlyDailyBox,\n\t\t\t\n\t\t};\n\t}\n\t//定义全局事件\n\tprotected defineGlobalEvents() {\n\t\tthis.g_events = {};\n\t}\n\t//绑定操作的回调\n\tconnectUi() {\n\t\tthis.connect(\"click\", this.ui.btn_close, this.close, \"关闭\");\n\t\tthis.connect(\"click\", this.ui.btn_buy, this.buy, \"购买月卡\");\n\t\tthis.connect(\"click\", this.ui.btn_receiveReward, this.openBox, \"开启宝箱\");\n\t}\n\t//网络事件回调begin\n\tbuyMonthlyCard() {\n\t\tthis.model.initData()\n\t\tthis.model.setClosingDate();\n\t\tthis.btn_buy.active = false;\n\t\tthis.btn_receiveReward.active = true;\n\t\tthis.note_closingDate.active = true;\n\t\tthis.view.showLabelString(this.ui.lab_closingDate,this.model.closingDate)\n\t}\n\trecMonthlyDailyBox(){\n\t\tModuleMgr.getInstance().showGainBox(cardMgr.getInstance().monthlyCardBox)\n\t\tthis.btn_receiveReward.active = false;\n\t\tthis.btn_beReceived.active = true;\n\t}\n\t//end\n\t//全局事件回调begin\n\t//end\n\t//按钮或任何控件操作的回调begin\n\t//end\n\tbuy() {\n\t\tcardMgr.getInstance().sendBuyMonthlyCard();\n\t}\n\topenBox(){\n\t\tcardMgr.getInstance().sendRecMonthlyDailyBox();\n\t}\n\t// update(dt) {}\n\tclose() {\n\t\tthis.closeModule(\"monthlyCard\")\n\t}\n\tonDestroy() {\n\t\tsuper.onDestroy();\n\t}\n}"]}