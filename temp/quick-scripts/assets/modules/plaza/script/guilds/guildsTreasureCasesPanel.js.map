{"version":3,"sources":["guildsTreasureCasesPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\guilds","sourcesContent":["import BaseModel from \"../../../../framework/baseClass/BaseModel\";\r\nimport BaseView from \"../../../../framework/baseClass/BaseView\";\r\nimport BaseCtrl from \"../../../../framework/baseClass/BaseCtrl\";\r\nimport { enums } from \"../../../../manager/enums\";\r\nimport GuildsMgr from \"../../../../manager/public/guildsMgr\";\r\nimport TableMgr from \"../../../../manager/public/tableMgr\";\r\nimport UserMgr from \"../../../../manager/public/userMgr\";\r\n\r\n/*\r\nauthor: 汤凯\r\n日期:2018-11-22\r\n*/\r\n\r\n//MVC模块,\r\nconst { ccclass, property } = cc._decorator;\r\nlet ctrl: GuildsTreasureCasesPanelCtrl;\r\n//模型，数据处理\r\nclass Model extends BaseModel {\r\n\tinGamePlayerContentHeight = 300;\r\n\tplayerInfoLeap = 110;\r\n\tplayersInfoList = GuildsMgr.getInstance().getGuildPlayersInfoList();\r\n\tguildInfo= GuildsMgr.getInstance().getGuildInfo();\r\n\tmyGuildInfo = GuildsMgr.getInstance().getMyGuildInfo();\r\n\tguildBoxInfo = null;\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t// if(!this.guildShopInfo)\r\n\t\t// {\r\n\t\t// \tShopMgr.getInstance().reqShopInfo(true);\r\n\t\t// }\r\n\t}\r\n}\r\n//视图, 界面显示或动画，在这里完成\r\nclass View extends BaseView {\r\n\tprotected model: Model;\r\n\tprotected node: cc.Node;\r\n\tpublic ui={\r\n\t\tpref_playerInfo: ctrl.pref_playerInfo,\r\n\t\tlbl_coinsAmt: ctrl.lbl_coinsAmt,\r\n\t\tlbl_cardsAmt: ctrl.lbl_cardsAmt,\r\n\t\tlbl_tickTime: ctrl.lbl_tickTime,\r\n\t\tspr_guildTreasureIcon: ctrl.spr_guildTreasureIcon,\r\n\t\tnode_inGamePlayersInfoContent: ctrl.node_inGamePlayersInfoContent,\r\n\t\tnode_outGamePlayersInfoContent: ctrl.node_outGamePlayersInfoContent,\r\n\t\tbar_guildBoxProgress: ctrl.bar_guildBoxProgress,\r\n\t\tinGameScroll_bar: ctrl.inGameScroll_bar\r\n\t}\r\n\tconstructor(model){\r\n\t\tsuper(model);\r\n\t\tthis.node = ctrl.node;\r\n\t\tthis.initUi();\r\n\t}\r\n\t//初始化ui\r\n\tpublic initUi() {\r\n\t\tthis.addPlayersInfoList();\r\n\t\tthis.refreshBoxInfo();\r\n\t}\r\n\tfindLevelBox()\r\n\t{\r\n\t\tlet nextLevel = this.model.guildInfo.boxLv+1;\r\n\t\tlet nextLevelBox =TableMgr.getInstance().search('Guild_Box',{boxLevel:nextLevel});\r\n\t\twhile(this.model.myGuildInfo.keyCount>nextLevelBox.cumulativeKey)\r\n\t\t{\r\n\t\t\tnextLevel++;\r\n\t\t\tnextLevelBox =TableMgr.getInstance().search('Guild_Box',{boxLevel:nextLevel});\r\n\t\t\tif(!nextLevelBox) {\r\n\t\t\t\tnextLevel--;\r\n\t\t\t\treturn TableMgr.getInstance().search('Guild_Box',{boxLevel:nextLevel});;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nextLevelBox;\r\n\t}\r\n\trefreshBoxInfo()\r\n\t{\r\n\t\tif(this.model.guildInfo&&this.model.myGuildInfo) {\r\n\t\t\tlet nextLevelBox = this.findLevelBox();\r\n\t\t\tlet boxInfo =TableMgr.getInstance().search('baoxiang_baoxiang',{id:nextLevelBox.boxId});\r\n\t\t\tif(boxInfo) {\r\n\t\t\t\tthis.model.guildBoxInfo = boxInfo;\r\n\t\t\t\tthis.model.guildBoxInfo.requiredKey = nextLevelBox.requiredKey;\r\n\t\t\t\tthis.ui.lbl_coinsAmt.string = Math.floor(this.model.guildBoxInfo.lowmoney + Math.random() * (this.model.guildBoxInfo.higmoney - this.model.guildBoxInfo.lowmoney));\r\n\t\t\t\tthis.ui.lbl_cardsAmt.string = Math.floor(this.model.guildBoxInfo.lowcard + Math.random() * (this.model.guildBoxInfo.higcard - this.model.guildBoxInfo.lowcard));\r\n\t\t\t\tthis.ui.bar_guildBoxProgress.progress = this.model.myGuildInfo.keyCount/nextLevelBox.requiredKey;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tpublic addPlayersInfoList()\r\n\t{\r\n\t\tlet inGamePlayersCount = 0;\r\n\t\tlet outGamePlayersCount = 0;\r\n\t\tif(this.model.playersInfoList&&this.model.playersInfoList.members.length>0&&this.node.active) {\r\n\t\t\tthis.ui.node_inGamePlayersInfoContent.destroyAllChildren();\r\n\t\t\tthis.ui.node_outGamePlayersInfoContent.destroyAllChildren();\r\n\t\t\tfor (let guildIdx = 0; guildIdx < this.model.playersInfoList.members.length; guildIdx++) {\r\n\t\t\t\tlet guildPlayerInfoData = this.model.playersInfoList.members[guildIdx];\r\n\t\t\t\tlet playerInfo = cc.instantiate(this.ui.pref_playerInfo);\r\n\t\t\t\tif(guildPlayerInfoData.keyCount>0) {\r\n\t\t\t\t\tinGamePlayersCount++;\r\n\t\t\t\t\tthis.ui.node_inGamePlayersInfoContent.addChild(playerInfo);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\toutGamePlayersCount++;\r\n\t\t\t\t\tthis.ui.node_outGamePlayersInfoContent.addChild(playerInfo);\r\n\t\t\t\t}\r\n\t\t\t\tplayerInfo.getComponent('guildPlayerInfo').updateAndShowGuildPlayerInfo(guildPlayerInfoData);\r\n\t\t\t}\r\n\t\t\tthis.ui.node_inGamePlayersInfoContent.setContentSize(this.ui.node_inGamePlayersInfoContent.getContentSize().width,(this.model.playersInfoList.page+1)*this.model.inGamePlayerContentHeight);\r\n\t\t\tthis.ui.node_outGamePlayersInfoContent.setContentSize(this.ui.node_inGamePlayersInfoContent.getContentSize().width,outGamePlayersCount*this.model.playerInfoLeap);\r\n\t\t}\r\n\t}\r\n\tshowTickTime(tickTime)\r\n\t{\r\n\t\tlet daysCube = Math.floor(tickTime/86400);\r\n\t\tif(daysCube>=10) {\r\n\t\t\tdaysCube = daysCube.toString();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tdaysCube = '0'+daysCube.toString();\r\n\t\t}\r\n\t\tlet hoursCube = Math.floor(tickTime/3600);\r\n\t\tif(hoursCube>=10) {\r\n\t\t\thoursCube = hoursCube.toString();\r\n\t\t}\r\n\t\telse{\r\n\t\t\thoursCube = '0'+hoursCube.toString();\r\n\t\t}\r\n\t\tthis.ui.lbl_tickTime.string = daysCube+\"天\"+hoursCube+\"时\";\r\n\t}\r\n}\r\n//c, 控制\r\n@ccclass\r\nexport default class GuildsTreasureCasesPanelCtrl extends BaseCtrl {\r\n\tprotected view: View;\r\n\tprotected model: Model;\r\n\t//这边去声明ui组件\r\n\t@property(cc.Prefab)\r\n\tpref_playerInfo: cc.Prefab = null;\r\n\t@property(cc.Label)\r\n\tlbl_coinsAmt: cc.Label = null;\r\n\t@property(cc.Label)\r\n\tlbl_cardsAmt: cc.Label = null;\r\n\t@property(cc.Label)\r\n\tlbl_tickTime: cc.Label = null;\r\n\t@property(cc.Sprite)\r\n\tspr_guildTreasureIcon: cc.Sprite = null;\r\n\t@property(cc.Node)\r\n\tnode_inGamePlayersInfoContent: cc.Node = null;\r\n\t@property(cc.Node)\r\n\tnode_outGamePlayersInfoContent: cc.Node = null;\r\n\t@property(cc.ProgressBar)\r\n\tbar_guildBoxProgress: cc.ProgressBar = null;\r\n\t@property(cc.ScrollView)\r\n\tinGameScroll_bar: cc.ScrollView = null;\r\n\t//声明ui组件end\r\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\r\n\r\n\tonLoad (){\r\n\t\t// 控制器\r\n\t\tctrl = this;\r\n\t\t// 创建mvc模式中模型和视图\r\n\t\tthis.initMvc(Model,View);\r\n\t\t//切换前后台需要对定时器进行清理和初始化\r\n        this.schedule(this.countDown.bind(this), 2);\r\n\t}\r\n\r\n\t//定义网络事件\r\n\tprotected defineNetEvents() {\r\n\t \tthis.n_events = {\r\n            'search.entry.reqGuildMembers':this.search_entry_reqGuildMembers,\r\n        };\r\n\t}\r\n\t//定义全局事件\r\n\tprotected defineGlobalEvents() {\r\n\t\tthis.g_events = {};\r\n\t}\r\n\t//绑定操作的回调\r\n\tconnectUi() {\r\n\t\tthis.connect(\"scroll-to-bottom\",this.ui.inGameScroll_bar.node,this.scrollToBottom.bind(this),\"拉到末尾\");\r\n\t\t// this.connect(\"click\",this.ui.btn_close,()=>{\r\n\t\t// \tthis.closeModule(\"guilds\");\r\n\t\t// },\"关闭公会界面\");\r\n\r\n\t}\r\n\tscrollToBottom()\r\n\t{\r\n\t\tGuildsMgr.getInstance().reqGuildMembers(UserMgr.getInstance().getMyInfo().guildId,GuildsMgr.getInstance().membersPage+1);\r\n\t}\r\n\tcountDown()\r\n\t{\r\n\t\tif(this.model.guildInfo&&this.model.guildInfo.boxTime>0){\r\n\t        let curTime = new Date().getTime();\r\n\t        let timeGap = Math.floor((curTime - this.model.guildInfo.boxTime)/1000);\r\n\t        if((timeGap)>=enums.GuildBox_Intervals)\r\n\t        {\r\n\t        \t//活动开始\r\n\t\t\t\t// ShopMgr.getInstance().reqShopInfo(true);\r\n\t        }\r\n\t        else{\r\n\t        \tthis.view.showTickTime(enums.GuildBox_Intervals-timeGap)\r\n\t        }\r\n\t\t}\r\n\t}\r\n\tsearch_entry_reqGuildMembers()\r\n\t{\r\n\t\tconsole.log(\"guild treasureCasePanel search_entry_reqGuildMembers\")\r\n\t\tthis.model.playersInfoList = GuildsMgr.getInstance().getGuildPlayersInfoList ();\r\n\t\tthis.model.guildInfo= GuildsMgr.getInstance().getGuildInfo();\r\n\t\tthis.view.addPlayersInfoList();\r\n\t\tthis.view.refreshBoxInfo();\r\n\t}\r\n\t//网络事件回调begin\r\n\t//end\r\n\t//全局事件回调begin\r\n\t//end\r\n\t//按钮或任何控件操作的回调begin\r\n\t//end\r\n\r\n\t// update(dt) {}\r\n\r\n\tonDestroy() {\r\n        this.unschedule(this.countDown);\r\n\t\tsuper.onDestroy();\r\n\t}\r\n}"]}