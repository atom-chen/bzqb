{"version":3,"sources":["fightPlayerMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script","sourcesContent":["import Emitter from \"../../../framework/modules/Emitter\";\nimport fightPlayerClass from \"./player/fightPlayerClass\";\nimport fightRandomSeed from \"./common/fightRandomSeed\";\nimport PlayerData from \"./modles/PlayerData\";\n\nimport config from \"./common/gameConfig\";\n/*\nauthor: 黄凯\n日期:2018-11-19\n*/\nlet emitter = Emitter.getInstance();\n// 随机数控制\nlet randomSeed = fightRandomSeed.getInstance();\n// 配置\nconst { netFrame , fightEvent , missileType } = config;\n\nconst teamEnumType = {\n\tteamOne:\"1\",\n\tteamTwo:\"2\"\n};\n\n// 测试数据 玩家出生点\nlet spownPoi = {\n\t\"1\":{\n\t\tx:-460,\n\t\ty:-143,\n\t},\n\t\"2\":{\n\t\tx:445,\n\t\ty:-189,\n\t},\n\t\"3\":{\n\t\tx:200,\n\t\ty:0,\n\t},\n\t\"4\":{\n\t\tx:400,\n\t\ty:0,\n\t},\n};\n\n\n// 玩家选择的角色对应的预制体索引值\nlet playerRoleToIndex = {\n\t\"1\":0,\n\t\"2\":1,\n};\n\n\n//切换玩家的几种情况 \n// 1，玩家行动回合 15秒没有操作 切换\n// 2，玩家行动后 发射炮弹 炮弹产生碰撞后切换\n// 3，玩家被冰冻 直接切换\n// 4，飞机\n\n\n// 玩家控制器数据层\nclass PlayerMgrModle{\n\t// 玩家座位id对应的玩家\n\tseatIdToPlayer:any;\n\t// 流程顺序座位id\n\tactionProcess:any;\n\t// 队伍对应的座位id\n\tteamToSeatId:any;\n\t// 当前回合数\n\tnowTimce:number;\n\t// 玩家总数\n\tplayerCount:number;\n\t// 我的座位id\n\tmySeatId:string;\n\t// 当前操做的玩家 TODO不存在座位id的玩家不能操作(观战)\n\tnowSeatId:string;\n\n\trolePrefab:cc.Prefab[];\n\n\tconstructor(){\n\t\t// 座位id对应的玩家实例化对象\n\t\tthis.seatIdToPlayer = {};\n\t\t// 行动流程\n\t\tthis.actionProcess = [];\n\t\t// 队伍对应的座位数组\n\t\tthis.teamToSeatId = {\n\t\t\t\"1\":[],\n\t\t\t\"2\":[]\n\t\t};\n\t\t// this.nowTimce = 1;\n\t}\n\n\t// 初始化玩家\n\tinit(rolePrefab:cc.Prefab[],players:any,fatherNode:cc.Node){\n\t\tthis.playerCount = Object.keys(players).length;\n\t\tthis.rolePrefab = rolePrefab;\n\n\t\t// TODO 初始化并分离玩家数据\n\t\tfor(let seatId in players){\n\t\t\t// 玩家的数据\n\t\t\tlet playerData:PlayerData = new PlayerData(players[seatId]);\n\t\t\tlet index = playerRoleToIndex[playerData.roleType];\n\t\t\tlet node:cc.Node = cc.instantiate(this.rolePrefab[index]);\n\t\t\tlet player:fightPlayerClass = node.getComponent(fightPlayerClass);\n\t\t\tlet team = playerData.team;\n\t\t\t// 设置玩家坐标\n\t\t\tplayerData.setPoi(spownPoi[seatId]);\n\t\t\t// 初始化玩家数据\n\t\t\tplayer.init(playerData);\n\t\t\tnode.parent = fatherNode;\n\t\t\tthis.teamToSeatId[team].push(seatId);\n\t\t\tthis.seatIdToPlayer[seatId] = player;\n\t\t}\n\t\t// 固定的流程与操作顺序\n\t\tthis.initActionProcess();\n\t\t// 初始玩家卡牌能量\n\t\tthis.initPlayerCardPower();\n\t\t// 初始第一个玩家座位\n\t\tthis.nowSeatId = this.actionProcess[0];\n\t\t// console.log(this.actionProcess);\n\t}\n\n\t// 通关流程顺序设置玩家的初始能量\n\tinitPlayerCardPower(){\n\t\tfor(let i = 0;i<this.actionProcess.length;i++){\n\t\t\tlet seatId = this.actionProcess[i];\n\t\t\tlet player = this.seatIdToPlayer[seatId];\n\t\t\tplayer.setCardPower(i);\n\t\t}\n\t}\n\n\t// 初始化玩家动作流程\n\tinitActionProcess(){\n\t\tlet randomTeam:string = this.changeRandomTeam(null);\n\t\tlet teamOne = this.teamToSeatId[\"1\"].slice(0);\n\t\tlet teamTwo = this.teamToSeatId[\"2\"].slice(0);\n\t\tfor(let i = 0;i < this.playerCount ; i++){\n\t\t\tlet seadId:string;\n\t\t\tswitch (randomTeam) {\n\t\t\t\tcase \"1\":\n\t\t\t\tseadId = this.getRandomAndRemove(teamOne);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"2\":\n\t\t\t\tseadId = this.getRandomAndRemove(teamTwo);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(i%2 === 0){\n\t\t\t\trandomTeam = this.changeRandomTeam(randomTeam);\n\t\t\t}\n\t\t\tthis.actionProcess.push(seadId);\n\t\t}\n\t}\n\n\n\t// 获取活着的玩家\n\tgetLivePlayers(){\n\t\tlet seatIdToRealPoi = {};\n\t\tfor(let i = 0;i<this.actionProcess.length;i++){\n\t\t\tlet seatId = this.actionProcess[i];\n\t\t\tlet player = this.getPlayerBySeatId(seatId);\n\t\t\tseatIdToRealPoi[seatId] = player.getPlayerRealPoi();\n\t\t}\n\t\treturn seatIdToRealPoi;\n\t}\n\n\n\t// 切换随机组队\n\tchangeRandomTeam(randomTeam){\n\t\tswitch (randomTeam) {\n\t\t\tcase \"1\":\n\t\t\t\treturn \"2\";\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\treturn \"1\";\n\t\t\t\tbreak;\n\t\t}\n\t\treturn randomSeed.random()>0.5?\"1\":\"2\";\n\t}\n\n\t// 获取就删除\n\tgetRandomAndRemove(teamList:any){\n\t\tlet count = teamList.length;\n\t\tlet index = Math.floor(randomSeed.random()*count);\n\t\treturn teamList.splice(index,1)[0];\n\t}\n\n\t// 切换玩家流程\n\tchangePlayer():void{\n\t\tlet count = this.actionProcess.length;\n\t\tif(count <= 1){\n\t\t\tconsole.log(\"游戏已经结束了不需要切换玩家\");\n\t\t\treturn;\n\t\t}\n\t\tlet nowIndex = this.actionProcess.indexOf(this.nowSeatId);\n\t\tif(nowIndex == count-1){\n\t\t\tnowIndex = 0;\n\t\t}else{\n\t\t\tnowIndex ++;\n\t\t}\n\t\t// 重新设置座位id\n\t\tthis.nowSeatId = this.actionProcess[nowIndex];\n\t\t// 流程++\n\t\t// this.nowTimce++;\n\t}\n\t\n\t// 检测单组玩家剩余个数\n\tcheckIsNoPlayer(teamType:string):number{\n\t\tlet { seatIdToPlayer,teamToSeatId } = this;\n\t\tlet liveIndex = 0;\n\t\tlet count = teamToSeatId[teamType].length;\n\t\tfor(let i = 0;i < count ; i++){\n\t\t\tlet player = teamToSeatId[teamType][i];\n\t\t\t// TODO 玩家是否活着\n\t\t\tif(player.getIsLive()){\n\t\t\t\tliveIndex++;\n\t\t\t}\n\t\t}\n\t\treturn liveIndex;\n\t}\n\n\t// 某玩家翘辫子\n\tplayerDead(seatId:string):void{\n\t\t// 每炸死一个玩家就判断一次游戏是否结束\n\t\tlet index = this.actionProcess.indexOf(seatId);\n\t\t// 删除行动流程\n\t\tthis.actionProcess.splice(index,1);\n\n\t}\n\n\t// 获取玩家座位id\n\tgetPlayerBySeatId(seatId:string):fightPlayerClass{\n\t\treturn this.seatIdToPlayer[seatId];\n\t}\n\n\t// 获取当前操作的玩家\n\tgetNowPlayer():fightPlayerClass{\n\t\treturn this.seatIdToPlayer[this.nowSeatId];\n\t}\n\n\t// 检测是否是该玩家的操做回合\n\tcheckIsNowSeatId(seatId:string):boolean{\n\t\treturn this.nowSeatId == seatId;\n\t}\n\n\t// 是否是我的回合\n\tcheckNowPlayerIsMine():boolean{\n\t\treturn this.nowSeatId == this.mySeatId;\n\t}\n\n\t// 获取我的玩家实例化对象\n\tgetMyPlayer():fightPlayerClass{\n\t\treturn this.seatIdToPlayer[this.mySeatId];\n\t}\n\n}\n\nlet taggerEnum = {\n\t\"show\":\"show\",\n\t\"hide\":\"hide\",\n};\n\n// 显示的事件绑定\nclass playerMgrView{\n\t// 切换显示隐藏我的操作\n\ttaggerMyCtrlUi(tagger:string){\n\t\temitter.emit(fightEvent.taggerMyCtrlUi,tagger);\n\t}\n\t// 移动控制器和能量条等\n\tmoveMyCtrlUi(poi:any){\n\t\temitter.emit(fightEvent.moveMyCtrlUi,poi);\n\t}\n\t// 更新行动能量条\n\tupdateMoveRange(range:number){\n\t\temitter.emit(fightEvent.updateMoveRange,range);\n\t}\n\t// 移动相机\n\tmoveCarame(lerp:cc.Vec2){\n\t\temitter.emit(fightEvent.setNowLerpPoi,lerp);\n\t}\n\n\t// 切换卡牌展示 效果要重做\n\tchangeCardList(cards){\n\t\temitter.emit(fightEvent.onCardChange,cards);\n\t}\n}\n\n\n// 我的回合\n// 1，发送数据给服务端\n// 2，显示操作相关的ui\n\n// 控制层\nexport default class fightPlayerMgr{\n\t// 模型层\n\tplayerMgrModle:PlayerMgrModle;\n\t// 渲染层\n\tplayerMgrView:playerMgrView;\n\t// 父节点\n\tfatherNode:cc.Node;\n\tconstructor(){\n\t\tthis.playerMgrModle = new PlayerMgrModle();\n\t\tthis.playerMgrView = new playerMgrView();\n\t}\n\n\t// 设置父节点\n\tpublic setFatherNode(node:cc.Node):void{\n\t\tthis.fatherNode = node;\n\t}\n\n\n\t// 初始化玩家控制器\n\tpublic init(rolePrefab:cc.Prefab[],players:any):void{\n\t\t// TODO 测试数据\n\t\tif(players == null){\n\t\t\t// 模拟数据\n\t\t\tplayers = {\n\t\t\t\t\"1\":{\n\t\t\t\t\tteam:\"1\",\n\t\t\t\t\tname:\"hk\",\n\t\t\t\t\tseatId:\"1\",\n\t\t\t\t\troleType:\"1\",\n\t\t\t\t},\n\t\t\t\t\"2\":{\n\t\t\t\t\tteam:\"2\",\n\t\t\t\t\tname:\"hk2\",\n\t\t\t\t\tseatId:\"2\",\n\t\t\t\t\troleType:\"2\",\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\t// 数据模型初始化\n\t\tthis.playerMgrModle.init(rolePrefab,players,this.fatherNode);\n\t}\n\n\t// 生成自身操作圈\n\tpublic setMyCircleCtrl(uiPrefab:cc.Prefab){\n\t\tlet myPlayer = this.getMyPlayer();\n\t\tlet node = cc.instantiate(uiPrefab);\n\t\t// console.log(\"myPlayer\",node);\n\t\tnode.parent = myPlayer.node;\n\t\tnode.active = true;\n\t}\n\n\tgetMyPlayer():fightPlayerClass{\n\t\treturn this.playerMgrModle.getMyPlayer();\n\t}\n\n\t// 通关玩家座位获取玩家实例化对象\n\tgetPlayerBySeatId(seatId){\n\t\treturn this.playerMgrModle.getPlayerBySeatId(seatId);\n\t}\n\n\t// 设置玩家真实位置\n\tpublic setPlayerNewPoi(seatId,realPoi){\n\t\tlet player:fightPlayerClass = this.getPlayerBySeatId(seatId);\n\t\tplayer.resetPoi(realPoi);\n\t}\n\n\t// 当前是不是自己的回合\n\tpublic checkPlayerIsMine():boolean{\n\t\treturn this.playerMgrModle.checkNowPlayerIsMine();\n\t}\n\n\t// 返回seatId 对应 真实坐标\n\tpublic getLivePlayers(){\n\t\treturn this.playerMgrModle.getLivePlayers();\n\t}\n\n\t// 通知当前操作的玩家 \n\tpublic goPlayerAction(){\n\t\t// 获取当前玩家\n\t\tlet player:fightPlayerClass = this.playerMgrModle.getNowPlayer();\n\n\t\t// 镜头移动\n\t\tlet playerRealPoi = player.getPlayerRealPoi();\n\t\tthis.playerMgrView.moveCarame(playerRealPoi);\n\t\t// 开始即时操做等\n\t\tplayer.startTrun();\n\t\t// TODO 如果是自己 显示ui 等\n\t\tif(this.checkPlayerIsMine()){\n\t\t\tlet cardList = player.getPlayerCardList();\n\t\t\tthis.playerMgrView.changeCardList(cardList);\n\t\t\tthis.playerMgrView.taggerMyCtrlUi(taggerEnum.show);\n\t\t}else{\n\t\t\tthis.playerMgrView.taggerMyCtrlUi(taggerEnum.hide);\n\t\t}\n\t}\n\n\t// 我的座位id\n\tpublic setMySeatId(seatId:string){\n\t\tthis.playerMgrModle.mySeatId = seatId;\n\t}\n\n\t// 切换玩家\n\tpublic changePlayer(){\n\t\t// 切换后玩家开始动起来\n\t\tthis.playerMgrModle.changePlayer();\n\t\t// 切换后玩家开始动起来\n\t\tthis.goPlayerAction();\n\t}\n\n\t// 某玩家翘辫子了\n\tpublic playerDead(seatId:string){\n\t\tthis.playerMgrModle.playerDead(seatId);\n\t}\n\n\t// 通过玩家各队死活 判断是否结束游戏\n\tpublic checkIsGameOver():boolean{\n\t\t// 队伍1 或者的数量\n\t\tlet teamOneLive:number = this.playerMgrModle.checkIsNoPlayer(teamEnumType[\"teamOne\"]);\n\t\t// 队伍2 或者的数量\n\t\tlet teamTwoLive:number = this.playerMgrModle.checkIsNoPlayer(teamEnumType[\"teamTwo\"]);\n\t\tif(teamOneLive <= 1){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// 干玩家\n\tdoPlayer(msg:any):void{\n\t\tif(!msg || msg.length < 1){ return; }\n\t\tmsg = msg[0];\n\t\tlet seatId:string = msg.seatId+\"\";\n\t\t// 检测是否该玩家的回合\n\t\tif(!this.playerMgrModle.checkIsNowSeatId(seatId)){\n\t\t\tconsole.log(\"不是该玩家的回合不能操作\");\n\t\t\treturn;\n\t\t}\n\t\t// 玩家对象\n\t\tlet player:fightPlayerClass = this.playerMgrModle.getNowPlayer();\n\t\tif(!player.getIsMyTrun()){\n\t\t\t// console.log(\"该玩家的回合已经结束\");\n\t\t\treturn;\n\t\t}\n\t\tlet data:any = msg.data;\n\t\t// 射击向量\n\t\tlet shootPoi:any = data.shootPoi;\n\t\t// 移动方向\n\t\tlet direction:number = data.direction;\n\t\t// 玩家当前举枪角度\n\t\tlet elevation:number = data.elevation;\n\t\t// 使用卡牌\n\t\tlet userCard:number = data.userCard;\n\t\t// 切换飞机\n\t\tlet changePlane:number = data.changePlane;\n\t\t// 移动1，-1\n\t\tif(direction){\n\t\t\t// 玩家移动\n\t\t\tplayer.move(direction);\n\t\t}\n\t\t// 使用纸飞机\n\t\tif(changePlane){\n\t\t\tconsole.log(\"使用飞机\",changePlane);\n\t\t\tplayer.changePlane(changePlane);\n\t\t}\n\t\t// 发射炮弹\n\t\tif(shootPoi){\n\t\t\tthis.playerMgrView.taggerMyCtrlUi(taggerEnum.hide);\n\t\t\tplayer.shootMis(shootPoi);\n\t\t}\n\t\t// 玩家当前角度\n\t\tif(elevation){\n\t\t\tplayer.changeAngle(elevation);\n\t\t}\n\t\t// 玩家使用卡牌\n\t\tif(userCard){\n\t\t\t// 使用成功返回true 使用失败不管\n\t\t\tif(player.useCard(userCard) && this.checkPlayerIsMine()){\n\t\t\t\t// 使用成功刷新ui\n\t\t\t\tlet cardList = player.getPlayerCardList();\n\t\t\t\tthis.playerMgrView.changeCardList(cardList);\n\t\t\t}\n\t\t}\n\t}\n\n\t// 检测是否是我的回合 然后操作ui位移等\n\tcheckIsMyTrun():void{\n\t\tif(this.checkPlayerIsMine()){\n\t\t\tlet player:fightPlayerClass = this.playerMgrModle.getNowPlayer();\n\t\t\tlet myRealPoi:any = player.getPlayerRealPoi();\n\t\t\tlet movePower:number = player.getMovePower();\n\t\t\t// myRealPoi = this.getWorldPoi(myRealPoi);\n\t\t\tthis.playerMgrView.moveMyCtrlUi(myRealPoi);\n\t\t\tthis.playerMgrView.updateMoveRange(movePower);\n\t\t}\n\t}\n\n\t// getWorldPoi(poi:any){\n\t// \treturn this.fatherNode.convertToWorldSpaceAR(poi);\n\t// }\n\n\t// 网络帧驱动\n\tnetFrame(msg:any):void{\n\t\tthis.doPlayer(msg);\n\t\tthis.checkIsMyTrun();\n\t}\n\n\n}\n\n"]}