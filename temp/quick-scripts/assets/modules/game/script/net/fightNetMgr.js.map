{"version":3,"sources":["fightNetMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\net","sourcesContent":["// import pomeloClass from \"../lib/hkpomelo\";\nlet pomeloClass = require(\"hkpomelo\");\n\n/*\nauthor: 黄凯\n日期:2018-11-19\n*/\nlet pomelo = new pomeloClass();\n\n// let host = \"127.0.0.1\";\n\n// let wsType = \"wss\";\n// // let host = \"118.25.127.17\";\n// let host = \"wxgame.088.com/jdqsnode\";\n// let port = \"\";\n\n// let wsType = \"wss\";\n// let host = \"wxgame.088.com\";\n// let port = \"2014\";\n\nlet host = \"192.168.30.41\";\nlet wsType = \"ws\";\nlet port = \"4100\";\n\nlet route = {\n    gate: 'gate.entry.testReq',\n    // 进入大厅\n    enter: 'connector.entry.testLogin',\n    // 房间\n    roomOrder: \"match.match.roomOrder\",\n    // 开始匹配\n    match: \"match.match.match\",\n    // 停止匹配\n    stopMatch: \"match.match.stopMatch\",\n    // 发送帧数据\n    send: \"fight.fight.send\",\n    // 玩家更新自身状态\n    state: \"fight.fight.state\",\n};\n// 发送房间操作\nlet order = {\n    // 创建房间\n    createRoom: 1,\n    // 加入房间\n    joinInRoom: 2,\n    // 准备\n    readyInRoom: 3,\n    // 开始游戏\n    startGame: 4,\n    // 踢出玩家\n    kickPlayer: 5,\n    // 主动退出房间\n    leaveRoom: 6,\n};\n// 发送战斗状态\nlet oprMsg = {\n    // 准备\n    ready: 1,\n    // 重连\n    reConnect: 2,\n    // 游戏结束\n    gameOver: 3,\n    // 玩家放弃游戏\n    giveup: 4,\n};\n// 接收服务器事件\nlet events = {\n    // 服务器推送帧给玩家\n    onFightFrame: \"onFightFrame\",\n    // 游戏过程中的玩家状态\n    onFightState: \"onFightState\",\n    // 开始匹配\n    onMatch: \"onMatch\",\n    // 匹配状态 客户端监听组队状态\n    matchState: \"matchState\",\n    // 匹配成功 客户端监听匹配成功\n    matchSuccess: \"matchSuccess\",\n};\n// 接收组队状态\nlet matchProtocol = {\n    // 玩家准备\n    ready: 1,\n    // 有玩家加入\n    joinIn: 2,\n    // 有玩家掉线\n    down: 3,\n    // 有玩家退出\n    giveup: 4,\n    // 房间已经解散\n    destroy: 5,\n    // 自己被踢了\n    beKick: 6,\n    // 游戏开始\n    gameStart: 7,\n};\n// 接收战斗状态 \nlet fightProtocol = {\n    // 有玩家准备（可以忽略不做）\n    ready: 1,\n    // 有玩家断线重连\n    reConnect: 2,\n    // 有玩家重新上线\n    online: 3,\n    // 有玩家掉线\n    down: 4,\n    // 玩家放弃比赛\n    giveup: 5,\n    // 游戏结束 结算数据\n    gameOver: 6,\n};\nclass pomeloMgr {\n    init(obj) {\n        console.log(obj);\n        for(let eventName in obj){\n            pomelo.on(eventName, obj[eventName]);\n        }\n        console.log(pomelo);\n        // pomelo.on(events.onMatch, onMatch);\n        // pomelo.on(events.onFightState, onFightState);\n        // pomelo.on(events.onFightFrame, onFightFrame);\n        // pomelo.on(events.matchState, matchState);\n        // pomelo.on(events.matchSuccess, matchSuccess);\n    }\n\n    off() {\n        pomelo.off(events.onMatch);\n        pomelo.off(events.onFightState);\n        pomelo.off(events.onFightFrame);\n        pomelo.off(events.matchState);\n        pomelo.off(events.matchSuccess);\n    }\n\n    connect(cb) {\n        let self = this;\n        pomelo.init({\n            host: host,\n            port: port,\n            wsType: wsType\n        }, function () {\n            let token = Math.floor(Math.random()*10000)+\"\", \n            openid = Math.floor(Math.random()*10000)+\"\";\n            pomelo.request(route.gate, {\n                openid: openid\n            }, (data) => {\n                // console.log(\"223\",data);\n                pomelo.disconnect(() => {\n                    pomelo.init({\n                        wsType: wsType,\n                        host: data.host,\n                        port: data.port\n                    }, function (data2) {\n                        pomelo.request(route.enter, {\n                            token: token,\n                            openid: openid\n                        }, function (data3) {\n                            console.log(data3);\n                            cb && cb(data3);\n                        });\n                    });\n                });\n            })\n        })\n    }\n    match(role, cb) {\n        pomelo.request(route.match, {\n            role: role\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    stopMatch(cb) {\n        pomelo.request(route.stopMatch, {}, (data) => {\n            cb && cb(data);\n        });\n    }\n    send(msg) {\n        // pomelo.request(route.send, msg, (data) => {\n        //     cb && cb(data);\n        // });\n        pomelo.notify(route.send, msg);\n    }\n    //------------房间操作-----\n    // 创建房间\n    creatRoom(role, cb) {\n        pomelo.request(route.roomOrder, {\n            state: order.createRoom,\n            role: role\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    // 加入房间\n    joinRoom(roomId, role, cb) {\n        pomelo.request(route.roomOrder, {\n            state: order.joinInRoom,\n            roomId: roomId,\n            role: role\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    // 准备\n    prepare(cb) {\n        pomelo.request(route.roomOrder, {\n            state: order.readyInRoom\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    // 开始游戏\n    startGame(cb) {\n        pomelo.request(route.roomOrder, {\n            state: order.startGame\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    // 踢出玩家\n    kickPlayer(seatId, cb) {\n        pomelo.request(route.roomOrder, {\n            state: order.kickPlayer,\n            seatId: seatId\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    // 退出房间\n    leaveRoom(cb) {\n        pomelo.request(route.roomOrder, {\n            state: order.leaveRoom\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    //----------战斗过程中操作-------\n    //发送准备开始\n    gameParpare(cb) {\n        pomelo.request(route.state, {\n            state: oprMsg.ready\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    //发送游戏结束 提交成绩\n    gameOver(winType, cb) {\n        pomelo.request(route.state, {\n            state: oprMsg.gameOver,\n            winType: winType\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n    //发送放弃游戏\n    gameGiveUp(cb) {\n        pomelo.request(route.state, {\n            state: oprMsg.giveup\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n\n    roomTest(cb) {\n        // pomelo.request(route.roomOrder, {\n        //     state: 8\n        // }, (data) => {\n        //     if (!this.errorCode(data)) return;\n        //     cb && cb(data);\n        // });\n    }\n\n    gameTest(cb) {\n        pomelo.request(route.state, {\n            state: 7\n        }, (data) => {\n            cb && cb(data);\n        });\n    }\n\n}\n\n\n\nexport default pomeloMgr;"]}