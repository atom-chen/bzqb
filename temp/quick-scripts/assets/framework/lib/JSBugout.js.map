{"version":3,"sources":["JSBugout.js"],"names":["sendDic","window","jsbugout","jsbugoutListenning","cc","sys","isNative","__handler","file","line","msg","error","console","log","handleError","undefined","xhr","loader","getXMLHttpRequest","onreadystatechange","url","open","setRequestHeader","ops","opstr","i","length","replace","data","userinfo","stack","send","JSON","stringify","module","exports"],"mappings":";;;;;;;;AAAA,IAAIA,UAAQ,EAAZ;AACA,CAAC,YAAW;AACXC,QAAO,iBAAP,IAA0B,EAA1B,CADW,CACkB;AAC7BA,QAAO,WAAP,IAAoB,EAApB,CAFW,CAEY;AACvB,KAAIC,WAAW,EAAf;AACAD,QAAOC,QAAP,GAAkBA,QAAlB;AACAA,UAASC,kBAAT,GAA8B,YAC9B;AACC,MAAIC,GAAGC,GAAH,CAAOC,QAAX,EAAqB;AACpB,OAAIC,kBAAJ;AACA,OAAIN,OAAO,gBAAP,CAAJ,EAA8B;AAC5BM,gBAAYN,OAAO,gBAAP,CAAZ;AACD;AACDA,UAAO,gBAAP,IAA2B,UAAUO,IAAV,EAAeC,IAAf,EAAoBC,GAApB,EAAyBC,KAAzB,EAAgC;AACzDC,YAAQC,GAAR,CAAY,WAAZ;AACAX,aAASY,WAAT,CAAqBN,IAArB,EAA0BC,IAA1B,EAA+BC,GAA/B,EAAoCC,KAApC;AACA,QAAIJ,SAAJ,EAAe;AAChBA,eAAUC,IAAV,EAAeC,IAAf,EAAoBC,GAApB,EAAyBC,KAAzB;AACE;AACF,IAND;AAOA;AACD,EAfD;AAgBAT,UAASY,WAAT,GAAuB,UAASN,IAAT,EAAcC,IAAd,EAAmBC,GAAnB,EAAwBC,KAAxB,EACvB;AAAA;;AACC;AACA,MAAG,QAAMD,GAAN,IAAWK,aAAWL,GAAzB,EACA;AACC;AACA;AACD;AACA,MAAGV,QAAQU,GAAR,CAAH,EACA;AACC;AACA;AACDV,UAAQU,GAAR,IAAa,IAAb;AACA;AACA,MAAIM,MAAMZ,GAAGa,MAAH,CAAUC,iBAAV,EAAV;AACAF,MAAIG,kBAAJ,GAAyB,YAAY,CACpC,CADD;AAEA;AACA,MAAIC,MAAInB,OAAO,kBAAP,KAA8B,4BAAtC;AACA;AACAe,MAAIK,IAAJ,CAAS,MAAT,EAAgBD,GAAhB,EAAoB,IAApB;AACAJ,MAAIM,gBAAJ,CAAqB,cAArB,EAAqC,gCAArC;AACA,MAAIC,MAAItB,OAAO,WAAP,CAAR;AACA,MAAIuB,QAAM,EAAV;AACA,OAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAEF,IAAIG,MAApB,EAA2B,EAAED,CAA7B,EACA;AACCD,YAAOD,IAAIE,CAAJ,CAAP;AACA,OAAGA,IAAEF,IAAIG,MAAJ,GAAW,CAAhB,EACA;AACCF,aAAO,IAAP;AACA;AACD;AACAb,UAAMA,MAAMgB,OAAN,CAAc,KAAd,EAAoB,IAApB,CAAN;AACAhB,UAAMA,MAAMgB,OAAN,CAAc,KAAd,EAAoB,IAApB,CAAN;AACD,MAAIC,OAAK;AACRL,QAAIC,KADI;AAERK,aAAS5B,OAAO,iBAAP,CAFD;AAGR6B;AACCtB,UAAKA,IADN;AAECE,YAFD,mCAEKA,GAFL,mCAGMD,IAHN,oCAIOE,KAJP;AAHQ,GAAT;AAUAK,MAAIe,IAAJ,CAASC,KAAKC,SAAL,CAAeL,IAAf,CAAT;AACA,EA7CD;AA8CA1B,UAASC,kBAAT;AACA+B,QAAOC,OAAP,GAAiBjC,QAAjB;AACA,CArED","file":"JSBugout.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\framework\\lib","sourcesContent":["var sendDic={};\r\n(function() {\r\n\twindow['__errorUserInfo']={};//错误日志的用户信息\r\n\twindow['__errorOp']=[];//错误日志的操作信息\r\n\tvar jsbugout = {};\r\n\twindow.jsbugout = jsbugout;\r\n\tjsbugout.jsbugoutListenning = function()\r\n\t{\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\tlet __handler\r\n\t\t\tif (window['__errorHandler']) {\r\n\t\t\t  __handler = window['__errorHandler']\r\n\t\t\t}\r\n\t\t\twindow['__errorHandler'] = function (file,line,msg, error) {\r\n\t\t\t  console.log('游戏报错,原生系统')\r\n\t\t\t  jsbugout.handleError(file,line,msg, error)\r\n\t\t\t  if (__handler) {\r\n\t\t\t\t__handler(file,line,msg, error)\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tjsbugout.handleError = function(file,line,msg, error)\r\n\t{\r\n\t\t//需要具体错误端\r\n\t\tif(null==msg||undefined==msg)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//发送过的类型就不再重复发送\r\n\t\tif(sendDic[msg])\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsendDic[msg]=true;\r\n\t\t//上报给服务器 \r\n\t\tlet xhr = cc.loader.getXMLHttpRequest();   \r\n\t\txhr.onreadystatechange = function () {  \r\n\t\t};    \r\n\t\t//报告地址\r\n\t\tvar url=window['__errorReportUrl'] || \"http://120.78.95.186:10001\"\r\n\t\t//url=\"http://192.168.30.28:10001\"\r\n\t\txhr.open(\"POST\",url,true); \r\n\t\txhr.setRequestHeader(\"Content-Type\", \"application/json;charset=utf-8\");\r\n\t\tvar ops=window['__errorOp'];\r\n\t\tvar opstr=\"\";\r\n\t\tfor(var i = 0;i<ops.length;++i)\r\n\t\t{\r\n\t\t\topstr+=ops[i]\r\n\t\t\tif(i<ops.length-1)\r\n\t\t\t{\r\n\t\t\t\topstr+='>>'\r\n\t\t\t}\r\n\t\t} \r\n\t  error=error.replace(/\\t/g,'&&')\r\n\t  error=error.replace(/\\n/g,'&&')\r\n\t\tvar data={\r\n\t\t\tops:opstr,\r\n\t\t\tuserinfo:window['__errorUserInfo'],\r\n\t\t\tstack:{\r\n\t\t\t\tfile:file,\r\n\t\t\t\tmsg,msg,\r\n\t\t\t\tline:line,\r\n\t\t\t\terror:error,\r\n\t\t\t}\r\n\t\t}\r\n\t\txhr.send(JSON.stringify(data)); \r\n\t}\r\n\tjsbugout.jsbugoutListenning();\r\n\tmodule.exports = jsbugout;\r\n})();"]}