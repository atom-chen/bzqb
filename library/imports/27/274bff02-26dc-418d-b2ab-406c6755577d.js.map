{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\framework\\modules/assets\\framework\\modules\\ModuleMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\framework\\modules","sourcesContent":["import LogMgr from \"./LogMgr\";\nimport Loader from \"./Loader\";\n\nexport default class ModuleMgr {\n\tprivate static _instance: ModuleMgr = new ModuleMgr();\n\tpublic static getInstance(): ModuleMgr {\n\t\treturn ModuleMgr._instance;\n\t}\n\tprivate _pubResPaths: any = require(\"publicResPath\");\n\tprivate _curResPaths: any = require(\"loginResPath\");\n\tprivate _lastResPaths: any = null;\n\n\tprivate _switchPaths(sceneName: string): void {\n\t\tthis._lastResPaths = this._curResPaths;\n\t\tthis._curResPaths = require(`${sceneName}ResPath`);\n\t}\n\t/**\n\t * 切换场景\n\t * @param sceneName 场景名\n\t */\n\tpublic switchScene(sceneName: string, routeArr?: string[]): void {\n\t\tthis._switchPaths(sceneName);\n\t\tthis.showLoading({\n\t\t\tresPaths: this._curResPaths,\n\t\t\trouteArr: routeArr,\n\t\t\tcomplete: () => {\n\t\t\t\tLogMgr.getInstance().switchScene(sceneName);\n\t\t\t\tcc.director.loadScene(sceneName);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _releaseRes(): void {\n\t\tlet urlArr = [];\n\t\tfor (let k in this._lastResPaths) {\n\t\t\tif (k == \"config\") continue;\n\t\t\tfor (let s in this._lastResPaths[k]) {\n\t\t\t\turlArr.push(this._lastResPaths[k][s]);\n\t\t\t}\n\t\t}\n\t\tLoader.getInstance().releaseRes(urlArr);\n\t}\n\n\tpublic getResUrl(type: string, name: string, isPublic: boolean = false): string {\n\t\tlet resPaths = this._pubResPaths;\n\t\tif (type !== \"config\" && !isPublic) resPaths = this._curResPaths;\n\t\treturn resPaths[type][name];\n\t}\n\n\t/**\n\t * 打开子模块\n\t * @param moduleName 模块名\n\t */\n\tpublic async openSubModule(moduleName: string, isPublic: boolean, isOnly: boolean = true): Promise<any> {\n\t\tlet curScene = cc.director.getScene();\n\t\tlet prefabInstance = curScene.getChildByName(moduleName);\n\t\tif (!prefabInstance || !cc.isValid(prefabInstance, true) || !isOnly) {\n\t\t\tlet resPaths = isPublic ? this._pubResPaths : this._curResPaths;\n\t\t\tlet prefab = await Loader.getInstance().loadPrefab(resPaths.prefab[moduleName]);\n\t\t\tprefabInstance = cc.instantiate(prefab);\n\t\t\tprefabInstance.parent = curScene;\n\t\t}\n\t\treturn prefabInstance.getComponent(prefabInstance.name);\n\t}\n\t/**\n\t * 加载图片\n\t * @param imageName 图片名\n\t * @param isPublic 是否是公共\n\t */\n\tpublic async loadImage(imageName: string, isPublic: boolean): Promise<cc.SpriteFrame> {\n\t\tlet resPaths = isPublic ? this._pubResPaths : this._curResPaths;\n\t\tlet spriteFrame = await Loader.getInstance().loadImage(resPaths.image[imageName]);\n\t\treturn spriteFrame;\n\t}\n\t/**\n\t * 关闭模块\n\t * @param moduleName 模块名\n\t */\n\tpublic closeModule(moduleName: string): void {\n\t\tlet instance = cc.director.getScene().getChildByName(moduleName);\n\t\tif (!instance) return console.log(\"没有打开此模块!\");\n\t\tif (cc.isValid(instance)) instance.destroy();\n\t}\n\n\tpublic showLoading(obj: { resPaths: any, routeArr?: string[], complete: Function }) {\n\t\tlet { resPaths, routeArr, complete } = obj;\n\t\tthis.openSubModule(\"loading\", true).then(script => {\n\t\t\tscript.setPreLoad({\n\t\t\t\tresPaths: resPaths,\n\t\t\t\trouteArr: routeArr,\n\t\t\t\tcomplete: complete\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic showMsgBox(obj: { content: string, title?: string, okcb?: Function }): void {\n\t\tlet { content, title, okcb } = obj;\n\t\tthis.openSubModule(\"msgBox\", true).then(script => {\n\t\t\tscript.init(title, content, okcb, null);\n\t\t});\n\t}\n\n\tpublic showDialog(obj: { content: string, title?: string, okcb?: Function, cancelcb?: Function }): void {\n\t\tlet { content, title, okcb, cancelcb } = obj;\n\t\tthis.openSubModule(\"msgBox\", true).then(script => {\n\t\t\tscript.init(title, content, okcb, cancelcb, false);\n\t\t});\n\t}\n\n\tpublic showGainBox(arr: { type: number, amount: number }[]): void {\n\t\tconsole.log(arr)\n\t\tthis.openSubModule(\"gainBox\", true).then(script => {\n\t\t\tscript.setGainData(arr);\n\t\t});\n\t}\n\tpublic showHandleGainBox(data): void {\n\t\tlet arr =[];\n\t\tfor(let key in data){\n\t\t\tif(typeof data[key]== \"object\"){\n\t\t\t\tfor (let i = 0; i < data[key].length; i++) {\n\t\t\t\t\tarr.push({\n\t\t\t\t\t\ttype:key,\n\t\t\t\t\t\tamount:data[key][i].amount,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tarr.push({\n\t\t\t\t\ttype:key,\n\t\t\t\t\tamount:data[key],\n\t\t\t\t})\n\t\t\t}\n\t\t\n\t\t}\n\t\tthis.showGainBox(arr)\n\t}\n\n\tpublic showTipBox(content: string): void {\n\t\tthis.openSubModule(\"tipBox\", true, false).then(script => {\n\t\t\tscript.setContent(content);\n\t\t});\n\t}\n\n\tpublic showJuhua(): void {\n\t\tthis.openSubModule(\"juhua\", true);\n\t}\n}\n"]}