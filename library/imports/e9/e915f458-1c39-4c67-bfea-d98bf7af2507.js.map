{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\physics/assets\\modules\\game\\script\\physics\\hkPhysics.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\physics","sourcesContent":["// 简单的物理实现\nimport HkRigidBody from \"./hkRigidBody\";\nimport config from \"../common/gameConfig\";\n/*\nauthor: 黄凯\n日期:2018-11-19\n*/\nconst { physicsConfig } = config;\n\nexport default class hkPhysics{\n    private static _instance: hkPhysics = new hkPhysics();\n    public static getInstance(): hkPhysics {\n        return hkPhysics._instance;\n    }\n\tbodies:any;\n\tgravity:any;\n\tenabled:boolean;\n\t\n\tconstructor(){\n\t\tthis.bodies = [];\n\t\tthis.gravity = physicsConfig.gravity;\n\t\tthis.enabled = false;\n\t}\n\t// 获取模拟效果\n\tstatic getBodyGuideLine(poi , force){\n    \tvar newVec = [];\n    \tvar body = {\n\t        force: {\n\t            x: 0,\n\t            y: 0\n\t        },\n\t        lineVelocity: {\n\t            x: force.x,\n\t            y: force.y\n\t        },\n\t        position: {\n\t            x: poi.x,\n\t            y: poi.y\n\t        },\n\t        mass: 1,\n\t    };\n\t\tfor (var i = 0; i < 30; i++) {\n\t        hkPhysics.doBodyMonitor(body);\n\t\t\tif(i%3 == 0){\n\t\t        newVec.push({\n\t\t            x: body.position.x,\n\t\t            y: body.position.y\n\t\t        });\n\t        }\n\t    }\n\t    return newVec;\n\t}\n\n\tstatic doBodyMonitor(body){\n\t\t\n\t\tbody.force.x += body.mass * physicsConfig.gravity.x;\n\t    body.force.y += body.mass * physicsConfig.gravity.y;\n\n\t    body.lineVelocity.x += body.force.x / body.mass;\n\t    body.lineVelocity.y += body.force.y / body.mass;\n\n\t    body.position.x += Math.round(body.lineVelocity.x / physicsConfig.physicsScale);\n\t    body.position.y += Math.round(body.lineVelocity.y / physicsConfig.physicsScale);\n\t}\n\t// 添加刚体\n\taddBody(body:HkRigidBody){\n\t\tthis.bodies.push(body);\n\t}\n\t// 删除刚体\n\tremoveBody(body:HkRigidBody){\n\t\tlet index = this.bodies.indexOf(body);\n\t\tif(index !== -1){\n\t\t\tthis.bodies.splice(index,1);\n\t\t}\n\t}\n\tnetFrame(){\n\t\tif(!this.enabled){ return; }\n\t\tlet count = this.bodies.length;\n\t\t// 遍历所有的body\n\t\tfor(var i = count-1 ; i >= 0 ;i--){\n\t\t\tlet body = this.bodies[i];\n\t\t\tbody.step();\n\t\t}\n\t}\n}\n\n"]}