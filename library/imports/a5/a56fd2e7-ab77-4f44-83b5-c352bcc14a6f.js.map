{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\carame/assets\\modules\\game\\script\\carame\\fightCameraMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\carame","sourcesContent":["import Emitter from \"../../../../framework/modules/Emitter\";\nlet emitter = Emitter.getInstance();\nimport config from \"../common/gameConfig\";\n\nconst { fightEvent } = config;\n\nconst {ccclass, property} = cc._decorator;\n\n/*\nauthor: 黄凯\n日期:2018-11-19\n*/\n    \n// TODO 初始化包围盒\n// TODO 滑动屏幕\n\n@ccclass\nexport default class fightCameraMgr extends cc.Component {\n\n    // 当前趋近的点\n    nowLerpPoi:cc.Vec2;\n    nowZoomRatio:number;\n    cameraNode:cc.Camera;\n\n    cameraAABB:any;\n\n    setNowAABB(ratio:number){\n        // 设置包围盒限制 TODO\n        let size = {\n            x:2340/2,\n            y:1080/2\n        };\n        let winSize = {\n            x:(cc.winSize.width/2+20)/ratio,\n            y:(cc.winSize.height/2+20)/ratio\n        };\n\n        this.cameraAABB = {\n            top:size.y-winSize.y,\n            bottom:-size.y+winSize.y,\n            left:-size.x+winSize.x,\n            right:size.x-winSize.x\n        };\n        // console.log(\"this.cameraAABB\",this.cameraAABB)\n\n    }\n\n    onLoad () {\n    \tthis.nowLerpPoi = new cc.Vec2(this.node.x,this.node.y); \n    \tthis.cameraNode = this.getComponent(cc.Camera);\n    \tthis.nowZoomRatio = 1;\n    \t// 绑定相机趋近事件\n    \temitter.on(fightEvent.setNowLerpPoi,this.setNowLerpPoi,this);\n    \temitter.on(fightEvent.setZoomRatio,this.setZoomRatio,this);\n        this.setNowAABB(1);\n    }\n\n    // 设置现行插值\n    setNowLerpPoi(poi:cc.Vec2){\n        this.nowLerpPoi = new cc.Vec2(poi.x,poi.y);\n        if(this.nowLerpPoi.y > this.cameraAABB.top){\n            this.nowLerpPoi.y = this.cameraAABB.top;\n        }else if(this.nowLerpPoi.y < this.cameraAABB.bottom){\n            this.nowLerpPoi.y = this.cameraAABB.bottom;\n        }\n        if(this.nowLerpPoi.x > this.cameraAABB.right){\n            this.nowLerpPoi.x = this.cameraAABB.right;\n        }else if(this.nowLerpPoi.x < this.cameraAABB.left){\n            this.nowLerpPoi.x = this.cameraAABB.left;\n        }\n    }\n\n    // 设置焦距\n    setZoomRatio(num:number):void{\n        num < 0.8 && (num = 0.8);\n    \tthis.nowZoomRatio = num;\n        this.setNowAABB(num);\n    }\n\n    // 相机的渐进\n    update (dt) {\n    \tif(this.nowLerpPoi){\n    \t\tthis.node.position = this.node.position.lerp(this.nowLerpPoi , 0.05);\n    \t}\n    \tif(Math.abs(this.cameraNode.zoomRatio - this.nowZoomRatio)>0.02){\n    \t\tthis.cameraNode.zoomRatio += (this.nowZoomRatio-this.cameraNode.zoomRatio)*0.02;\n    \t}\n    }\n    \n\n    onDestroy(){\n    \temitter.off(fightEvent.setNowLerpPoi,this);\n    \temitter.off(fightEvent.setZoomRatio,this);\n    }\n}\n"]}