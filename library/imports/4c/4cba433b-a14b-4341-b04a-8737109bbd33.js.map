{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\manager\\public/assets\\manager\\public\\friendsMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\manager\\public","sourcesContent":["import BaseMgr from \"../../framework/baseClass/BaseMgr\";\r\nimport Package from \"../../framework/net/package\";\r\nimport { dataids } from \"../../framework/net/dataids\";\r\nimport { enums } from \"../enums\";\r\n\r\nimport { chatList, chatItem, chat } from \"../../manager/public/interface/iFriend\";\r\nimport RegisterCtrl from \"../../modules/login/script/registerPanel\";\r\n\r\nexport default class FriendsMgr extends BaseMgr {\r\n    public friendsIds = null;\r\n    public friendsInfoList = null;\r\n    public friendsId = null;\r\n    public friendsIdKicked = null;\r\n    public myId = null\r\n\r\n    private searchResult = [];\r\n\r\n    public chatContent:chatList = <chatList>{}\r\n\r\n    constructor() {\r\n        super();\r\n        this.routes = {\r\n            'plaza.data.reqFriendIds': this.plaza_data_reqFriendIds,\r\n            'search.entry.reqFriendInfos': this.search_entry_reqFriendInfos,\r\n            'plaza.friends.addFriend': this.plaza_friends_addFriend,\r\n            \"plaza.friends.kickFriend\": this.plaza_friends_kickFriend,\r\n            \"search.entry.searchUsers\": this.search_entry_searchUsers,\r\n            \"search.entry.randomUsers\": this.search_entry_randomUsers,\r\n            \"onChat\":this.onChat,\r\n\r\n            \"onNewFriend\": this.onNewFriend,\r\n            \"onKickedByFriend\": this.onKickedByFriend,\r\n        };\r\n    }\r\n    clearDatas()\r\n    {\r\n        this.friendsIds = null;\r\n        this.friendsInfoList = null;\r\n        this.friendsId = null;\r\n        this.friendsIdKicked = null;\r\n    }\r\n\r\n    //返回推荐好友\r\n    public search_entry_randomUsers(msg: Package){\r\n        let userInfo = msg.getDataByType(dataids.ID_USERLIST);\r\n    }\r\n\r\n    public isAlwaysSearch(data): any{\r\n        var count = this.searchResult.length\r\n        for(var i = 0; i < count; i++){\r\n            var userInfo = this.searchResult[i]\r\n            if(userInfo.nickname == data || userInfo.id == parseInt(data)){\r\n                return userInfo\r\n            }\r\n        }\r\n\r\n        return null\r\n    }\r\n\r\n    //搜索用户返回\r\n    public search_entry_searchUsers(msg: Package){\r\n        let userInfo = msg.getDataByType(dataids.ID_USERLIST);\r\n\r\n        for(var i = 0; i < userInfo.length; i++){\r\n            this.searchResult.push(userInfo[i])\r\n        }\r\n        this.searchResult = userInfo\r\n        if(userInfo.length > 0){\r\n            this.gemit(\"friends_search_Result\", userInfo[0]);\r\n        }\r\n    }\r\n\r\n    //判断是否好友\r\n    isFriend(id)\r\n    {\r\n        for (let friendsIdsIdx = 0; friendsIdsIdx < this.friendsIds.friends.length; friendsIdsIdx++) {\r\n            if(this.friendsIds.friends[friendsIdsIdx] == id) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    // 单例处理\r\n    private static _instance: FriendsMgr = null;\r\n    public static getInstance(): FriendsMgr {\r\n        if (FriendsMgr._instance == null) {\r\n            FriendsMgr._instance = new FriendsMgr();\r\n        }\r\n        return FriendsMgr._instance;\r\n    }\r\n\r\n    private plaza_data_reqFriendIds(msg: Package): void {\r\n        this.friendsIds = msg.getDataByType(dataids.ID_FRIEND_IDS);\r\n        if(this.friendsIds){\r\n            this.myId = this.friendsIds.id\r\n            this.reqFriendInfos(this.friendsIds.friends)\r\n        }\r\n    }\r\n\r\n    private search_entry_reqFriendInfos(msg: Package): void {\r\n        this.friendsInfoList = msg.getDataByType(dataids.ID_FRIENDINFOLIST);\r\n    }\r\n\r\n    public onNewFriend(msg:Package): void {\r\n        let addFriendId = msg.getData().friendId\r\n        this.addnewIdToIDs(addFriendId)\r\n        this.reqFriendInfos(this.friendsIds.friends)\r\n    }\r\n\r\n    public plaza_friends_addFriend(msg: Package): void {\r\n        let addFriendId = msg.getDataByType(dataids.ID_ADDFRIEND);\r\n        this.addnewIdToIDs(addFriendId)\r\n        this.reqFriendInfos(this.friendsIds.friends)\r\n    }\r\n\r\n    private addnewIdToIDs(id){\r\n        if(this.friendsIds&&this.friendsIds.friends) {\r\n            this.friendsIds.friends.push(id);\r\n        }\r\n        else{\r\n            this.friendsIds={};\r\n            this.friendsIds.friends=[];\r\n            this.friendsIds.friends.push(id);\r\n        }\r\n    }\r\n\r\n    public onKickedByFriend(msg:Package): void{\r\n        let friendsIdKicked = msg.getData().friendId\r\n        this.delIdFromIds(friendsIdKicked)\r\n        this.reqFriendInfos(this.friendsIds.friends)\r\n    }\r\n\r\n    public plaza_friends_kickFriend(msg: Package): void {\r\n        let friendsIdKicked = msg.getDataByType(dataids.ID_KICKFRIEND);\r\n        this.delIdFromIds(friendsIdKicked)\r\n        this.reqFriendInfos(this.friendsIds.friends)\r\n    }\r\n\r\n    private delIdFromIds(id){\r\n        let count = this.friendsIds.friends.length\r\n        for(var i = 0; i < count; i++){\r\n            if(id == this.friendsIds.friends[i]){\r\n                this.friendsIds.friends.splice(i, 1)\r\n                break\r\n            }\r\n        }\r\n    }\r\n\r\n    public onChat(msg: Package): void {\r\n        let data = msg.getDataByType(dataids.ID_CHAT_WITH_FRIEND);\r\n        \r\n        if(!this.chatContent.list){\r\n            this.chatContent.list = []\r\n        }\r\n\r\n        let l_chat:chat = <chat>{}\r\n        l_chat.fromID = data.from\r\n        l_chat.content = data.content\r\n\r\n        let uid\r\n        if(data.from == this.myId){\r\n            uid = data.to\r\n        }else if(data.to == this.myId){\r\n            uid = data.from\r\n        }\r\n\r\n        if(!this.chatContent.list[uid]){\r\n            this.chatContent.list[uid] = <chatItem>{}\r\n            this.chatContent.list[uid].chatContent = []\r\n        }\r\n        this.chatContent.list[uid].chatContent.push(l_chat)\r\n        this.gemit(\"chat.recNewChat\", uid, l_chat);\r\n    }\r\n\r\n    public getFriendInfos(id): any{\r\n        let l_count = this.friendsInfoList.length\r\n        let info\r\n        for(var i = 0; i < l_count; i++){\r\n            if(this.friendsInfoList[i].id == id){\r\n                info = this.friendsInfoList[i]\r\n                break\r\n            }\r\n        }\r\n        return info\r\n    }\r\n\r\n    public reqFriendIds(): void {\r\n        let route = 'plaza.data.reqFriendIds';\r\n        this.send_msg(route);\r\n    }\r\n\r\n    public reqFriendInfos(data: any): void {\r\n        let route = 'search.entry.reqFriendInfos';\r\n        this.send_msg(route,{'ids':data});\r\n    }\r\n\r\n    public addFriend(data: any): void {\r\n        let route = 'plaza.friends.addFriend';\r\n        this.send_msg(route,{'friendId':data});\r\n    }\r\n\r\n    public kickFriend(data: any): void {\r\n        let route = 'plaza.friends.kickFriend';\r\n        this.send_msg(route,{'friendId':data});\r\n    }\r\n\r\n    public searchFriend(data:any): void{\r\n        let route = 'search.entry.searchUsers';\r\n        this.send_msg(route,{'key':data});\r\n    }\r\n\r\n    public searchRandomUsers(){\r\n        let route = 'search.entry.randomUsers'\r\n        this.send_msg(route)\r\n    }\r\n\r\n    public sendChat(from:any, to:any, content:any): void {\r\n        let route = 'chat.entry.chatWithFriend'\r\n        this.send_msg(route, {'from':from, 'to':to, 'content':content})\r\n    }\r\n\r\n}\r\n"]}