{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\effects/assets\\modules\\plaza\\script\\effects\\effects.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\effects","sourcesContent":["import BaseModel from \"../../../../framework/baseClass/BaseModel\";\nimport BaseView from \"../../../../framework/baseClass/BaseView\";\nimport BaseCtrl from \"../../../../framework/baseClass/BaseCtrl\";\nimport { userMoney } from \"../../../../manager/public/interface/iUserInfo\";\nimport UserMgr from \"../../../../manager/public/userMgr\";\nimport { effectList, effectCfgList } from \"../../../../manager/public/interface/iEffect\";\nimport EffectMgr from \"../../../../manager/public/effectMgr\";\n\n/*\nauthor: 陈斌杰\n日期:2018-11-07 15:28:25\n*/\n\n//MVC模块,\nconst { ccclass, property } = cc._decorator;\nlet ctrl: CardsCtrl;\n//模型，数据处理\nclass Model extends BaseModel {\n\tconstructor() {\n\t\tsuper();\n\t}\n\tpublic userMoney: userMoney = UserMgr.getInstance().userMoney;\n\tpublic effectList: effectList = EffectMgr.getInstance().effectList;\n\tpublic effectCfgList: effectCfgList = EffectMgr.getInstance().effectCfgList;\n\tpublic interimCfg: number[] = EffectMgr.getInstance().interimCfg;\t\t//临时特技配置id数组\n\tpublic sortState: number = 0;\t// -1 小到大、1 大到小\n\n\t//设置添加的特技配置数据\n\tpublic addEffectConfigData(effectId: any): void {\n\t\tfor (let i = 0; i < this.interimCfg.length; i++) {\n\t\t\tif (this.interimCfg[i] == 0) {\n\t\t\t\tthis.interimCfg[i] = effectId;\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t}\n\n\t//删除配置特技数据\n\tpublic delEffectConfigData(effectId: any): void {\n\t\tfor (let i = 0; i < this.interimCfg.length; i++) {\n\t\t\tif (this.interimCfg[i] == 0) { break }\n\t\t\tif (this.interimCfg[i] == effectId) {\n\t\t\t\tthis.interimCfg[i] = 0;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (this.interimCfg[i - 1] == 0) {\n\t\t\t\tthis.interimCfg[i - 1] = this.interimCfg[i];\n\t\t\t\tthis.interimCfg[i] = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t//设置按照星级排序按钮状态\n\tpublic setSortState(): void {\n\t\tif (this.sortState == 0) {\n\t\t\tthis.sortState = -1;\n\t\t}\n\t\tif (this.sortState == -1) {\n\t\t\tthis.sortState = 1;\n\t\t}\n\t\tif (this.sortState == 1) {\n\t\t\tthis.sortState = -1;\n\t\t}\n\t}\n\n\t//设置特技数据按照星级排序\n\tpublic sortEffectData(): void {\n\t\tthis.setSortState();\n\t\tEffectMgr.getInstance().sortEffectData(this.sortState);\n\t}\n\n\t//获取保存的特技配置数据并发送\n\tpublic getEffectCfgData_sendReq(): void {\n\t\tlet data: any = [];\n\t\tfor (let i = 0; i < this.effectList.list.length; i++) {\n\t\t\tlet effect = this.effectList.list[i];\n\t\t\tfor (let j = 0; j < this.interimCfg.length; j++) {\n\t\t\t\tif (this.interimCfg[j] == 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (effect.itemId == this.interimCfg[j]) {\n\t\t\t\t\tdata.push(effect.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (data.length == EffectMgr.getInstance().effectNum) {\n\t\t\tEffectMgr.getInstance().sendReqEffectCfgData(data);\n\t\t}\n\t}\n}\n//视图, 界面显示或动画，在这里完成\nclass View extends BaseView {\n\tprotected model: Model;\n\tprotected node: cc.Node;\n\tpublic ui = {\n\t\tbtn_close: ctrl.btn_close,\t\t\t\t\t\t\t\t\t\t\t\t\t//关闭特技界面按钮\n\t\tgold: ctrl.moneyFrame.getChildByName(\"gold\").getComponent(cc.Label),\t\t//金币\n\t\tcrystal: ctrl.moneyFrame.getChildByName(\"crystal\").getComponent(cc.Label),\t//粉晶\n\t\tdiamond: ctrl.moneyFrame.getChildByName(\"diamond\").getComponent(cc.Label),\t//钻石\n\t\teffectList_content: ctrl.effectList_content,\t\t\t\t\t\t\t\t//特技列表content\n\t\teffectCfgList_content: ctrl.effectCfgList_content,\t\t\t\t\t\t\t//特技配置列表content\n\t\teffect: ctrl.effect,\t\t\t\t\t\t\t\t\t\t\t\t\t\t//特技预制\n\t\teffectConfig: ctrl.effectConfig,\t\t\t\t\t\t\t\t\t\t\t//特技配置预制\n\t\teffectCount: ctrl.effectCount,\t\t\t\t\t\t\t\t\t\t\t\t//特技数量\n\t\tbtn_sort: ctrl.btn_sort,\t\t\t\t\t\t\t\t\t\t\t\t\t//特技排序\n\t\tbtn_hold: ctrl.btn_hold,\t\t\t\t\t\t\t\t\t\t\t\t\t//特技配置保存按钮\n\t}\n\tconstructor(model) {\n\t\tsuper(model);\n\t\tthis.node = ctrl.node;\n\t\tthis.initUi();\n\t}\n\t//初始化ui\n\tpublic initUi() {\n\t\tthis.refreshMoneyUI();\n\n\t\tthis.initEffectList();\n\t\tthis.initEffectCfgList();\n\t}\n\n\t//初始化特技列表\n\tpublic initEffectList(): void {\n\t\tvar list = this.model.effectList.list;\n\t\tlet row: number = 0;\n\t\tlet column: number = 0;\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tlet effectData: any = list[i];\n\t\t\tlet effect = this.addPrefabNode(this.ui.effect, this.ui.effectList_content);\n\t\t\t//设置坐标\n\t\t\tcolumn = i % 4;\n\t\t\tif (i != 0 && i % 4 == 0) {\n\t\t\t\trow++;\n\t\t\t\tthis.ui.effectList_content.height = 250 * (row + 1);\n\t\t\t}\n\t\t\teffect.x = -250 + 170 * column;\n\t\t\teffect.y = -125 - 250 * row;\n\t\t\t//设置特技属性\n\t\t\teffect.getComponent(\"effect\").initEffectData(effectData);\n\t\t}\n\t}\n\n\t//刷新特技界面金钱数据\n\tpublic refreshMoneyUI(): void {\n\t\tthis.ui.gold.string = this.numberEllipsis(this.model.userMoney.gold);\n\t\tthis.ui.crystal.string = this.numberEllipsis(this.model.userMoney.crystal);\n\t\tthis.ui.diamond.string = this.numberEllipsis(this.model.userMoney.diamond);\n\t}\n\n\t//刷新特技界面\n\tpublic refreshEffectList(): void {\n\t\tvar list = this.model.effectList.list;\n\t\tfor (let i = 0; i < this.ui.effectList_content.childrenCount; i++) {\n\t\t\tlet effectNode = this.ui.effectList_content.children[i];\n\t\t\teffectNode.getComponent(\"effect\").initEffectData(list[i]);\n\t\t}\n\t}\n\n\t//初始化特技配置列表\n\tpublic initEffectCfgList(): void {\n\t\tlet list = this.model.effectCfgList.list;\n\t\tthis.ui.effectCfgList_content.height = list.length * 160;\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tlet effectCfgData: any = list[i];\n\t\t\tthis.model.interimCfg.push(effectCfgData.effectId);\n\t\t\tlet effectCfg = this.addPrefabNode(this.ui.effectConfig, this.ui.effectCfgList_content);\n\t\t\t//设置坐标\n\t\t\teffectCfg.y = -75 - i * 160;\n\t\t\t//设置配置的特技属性\n\t\t\teffectCfg.getComponent(\"effectConfig\").initEffectCfg(effectCfgData);\n\t\t}\n\t\tthis.refreshEffectCount();\n\t}\n\n\t//刷新特技数量显示\n\tpublic refreshEffectCount(): void {\n\t\tlet effectNum = 0;\t\t//当前装备特技数量\n\t\tlet user = UserMgr.getInstance().user;\n\t\tlet list = this.model.interimCfg;\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tif (list[i] != 0) {\n\t\t\t\teffectNum++;\n\t\t\t}\n\t\t}\n\t\tEffectMgr.getInstance().setEffectNum(effectNum);\n\t\tthis.ui.effectCount.string = EffectMgr.getInstance().effectNum.toString() + \"/\" + EffectMgr.getInstance().allEffectNum.toString();\n\t}\n\n\t//刷新特技配置\n\tpublic refreshEffectCfg(): void {\n\t\tthis.refreshEffectCount();\n\t\tif (this.model.interimCfg.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0; i < this.model.interimCfg.length; i++) {\n\t\t\tlet effectId = this.model.interimCfg[i];\n\t\t\tthis.ui.effectCfgList_content.children[i].getComponent(\"effectConfig\").refreshEffectCfg(effectId);\n\t\t}\n\t}\n}\n//c, 控制\n@ccclass\nexport default class CardsCtrl extends BaseCtrl {\n\tprotected view: View;\n\tprotected model: Model;\n\t//这边去声明ui组件\n\t@property(cc.Button)\n\tbtn_close: cc.Button = null;\n\t@property(cc.Node)\n\tmoneyFrame: cc.Node = null;\n\t@property(cc.Node)\n\teffectList_content: cc.Node = null;\n\t@property(cc.Node)\n\teffectCfgList_content: cc.Node = null;\n\t@property(cc.Label)\n\teffectCount: cc.Label = null;\n\t@property(cc.Prefab)\n\teffect: cc.Prefab = null;\n\t@property(cc.Prefab)\n\teffectConfig: cc.Prefab = null;\n\t@property(cc.Button)\n\tbtn_sort: cc.Button = null;\n\t@property(cc.Button)\n\tbtn_hold: cc.Button = null;\n\t//声明ui组件end\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\n\n\tonLoad() {\n\t\t// 控制器\n\t\tctrl = this;\n\t\t// 创建mvc模式中模型和视图\n\t\tthis.initMvc(Model, View);\n\t}\n\n\t//定义网络事件\n\tprotected defineNetEvents() {\n\t\tthis.n_events = {};\n\t}\n\t//定义全局事件\n\tprotected defineGlobalEvents() {\n\t\tthis.g_events = {\n\t\t\t\"btn_addEffectConfig\": this.addEffectConfig,\n\t\t\t\"btn_delEffectCfg\": this.delEffectCfg,\n\t\t\t\"upEffect\": this.upEffect,\n\t\t\t\"effectCfg\": this.effectCfg,\n\t\t\t\"refreshMoneyUI\": this.refreshMoneyUI,\n\t\t};\n\t}\n\t//绑定操作的回调\n\tconnectUi() {\n\t\tthis.connect(\"click\", this.ui.btn_close, () => {\n\t\t\tthis.closeModule(\"effects\");\n\t\t}, \"关闭特技界面\");\n\t\tthis.connect(\"click\", this.ui.btn_sort, () => {\n\t\t\tthis.model.sortEffectData();\n\t\t\tthis.view.refreshEffectList();\n\t\t}, \"特技按照星级排序\");\n\t\tthis.connect(\"click\", this.ui.btn_hold, () => {\n\t\t\tthis.model.getEffectCfgData_sendReq();\n\t\t}, \"发送保存特技配置\");\n\t}\n\t//网络事件回调begin\n\t//end\n\t//全局事件回调begin\n\t//end\n\t//按钮或任何控件操作的回调begin\n\t//end\n\n\t//加入配置的特技到特技栏\n\tpublic addEffectConfig(effectId: number): void {\n\t\tthis.model.addEffectConfigData(effectId);\n\t\tthis.view.refreshEffectCfg();\n\t}\n\n\t//删除配置中的特技\n\tpublic delEffectCfg(effectId: number): void {\n\t\tthis.model.delEffectConfigData(effectId);\n\t\tthis.view.refreshEffectCfg();\n\t}\n\n\t//升级特技\n\tpublic upEffect(): void {\n\t\t//刷新界面UI\n\t\tthis.view.refreshEffectList();\n\t\tthis.view.refreshEffectCfg();\n\t\tthis.closeModule(\"effectInfo\");\n\t}\n\n\t//保存的特技配置\n\tpublic effectCfg(): void {\n\t\t//刷新特技配置UI\n\t}\n\n\t//刷新金钱显示\n\tpublic refreshMoneyUI(): void {\n\t\tthis.view.refreshMoneyUI();\n\t}\n\n\tonDestroy() {\n\t\tsuper.onDestroy();\n\t}\n}"]}