{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\net/assets\\modules\\game\\script\\net\\fightNetPoolMgr.ts"],"names":[],"mappings":";;;;;AAAA;;;EAGE;AACF,QAAQ;AACR;IAuBI;QACI,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,GAAC,CAAC,IAAI,CAAC,QAAQ,GAAC,CAAC,CAAC,CAAC,CAAC;QACpD,+CAA+C;QAC/C,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC;IAC/B,CAAC;IACM,8BAAQ,GAAf;QACI,IAAI,CAAC,iBAAiB,EAAG,CAAC;IAC9B,CAAC;IACM,8BAAQ,GAAf,UAAgB,KAAS;QACrB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC;IACD,QAAQ;IACD,kCAAY,GAAnB;QACI,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;IAClC,CAAC;IACD,QAAQ;IACD,mCAAa,GAApB;QACI,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;IACjC,CAAC;IACM,kCAAY,GAAnB;QACI,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IACD,aAAa;IACN,mCAAa,GAApB;QACI,OAAO,IAAI,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;IAC/C,CAAC;IACD,cAAc;IACP,sCAAgB,GAAvB,UAAwB,EAAE;QACtB,IAAI,CAAC,SAAS,IAAI,EAAE,GAAC,IAAI,CAAC;QAC1B,IAAI,UAAU,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;QACtC,IAAI,UAAU,GAAG,KAAK,CAAC;QACvB,OAAO;QACP,8CAA8C;QAC9C,6BAA6B;QAC7B,0BAA0B;QAC1B,iCAAiC;QACjC,uCAAuC;QACvC,QAAQ;QACR,IAAI;QACJ,OAAO;QACP,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,EAAE;YAClC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC;YACjC,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,UAAU,IAAI,IAAI,CAAC,OAAO,EAAE;gBAC/C,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;aACzB;YACD,2BAA2B;YAC3B,iCAAiC;YACjC,cAAc;YACd,IAAI;YACJ,OAAO;YACP,IAAI,IAAI,CAAC,SAAS,IAAI,UAAU,GAAG,CAAC,EAAE;gBAClC,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;gBACjB,UAAU,GAAG,IAAI,CAAC;gBAClB,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAChB,kBAAkB;gBAClB,iDAAiD;gBACjD,sBAAsB;gBACtB,IAAI;gBACJ,OAAO;gBACP,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;gBACvB,qBAAqB;aACxB;iBAAM,IAAI,IAAI,CAAC,SAAS,IAAI,UAAU,KAAK,CAAC,EAAE;gBAC3C,IAAI,CAAC,OAAO,EAAE,CAAC;aAClB;SAEJ;QACD,OAAO,UAAU,CAAC;IACtB,CAAC;IACL,kBAAC;AAAD,CAhGA,AAgGC,IAAA","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\net","sourcesContent":["/*\nauthor: 黄凯\n日期:2018-11-19\n*/\n// 帧数管理器\nexport default class netFrameMgr{\n    // 留存的帧数据\n    frameList:any;\n    // 帧缓存\n    poolNum:number;\n    // 帧间隔\n    frameTime:number;\n    // 帧速率\n    frameFps:number;\n    // 帧起始点\n    startTime:number;\n    // 延迟次数\n    lagTime:number;\n    // 是否显示菊花\n    nowIsShow:boolean;\n    // \n    isShowFlower:boolean;\n    // 是否显示延迟\n    isShowLag:boolean;\n    // 游戏第一次开始时\n    gameStart:boolean;\n    // 帧数计数器\n    hisTroyFrameCount:number;\n    constructor(){\n        this.poolNum = 1;\n        this.frameFps = 20;\n        this.frameTime = Math.round(1000/(this.frameFps-4));\n        // console.log(\"this.frameTime\",this.frameTime)\n        this.frameList = [];\n        this.startTime = 0;\n        this.isShowLag = false;\n        this.hisTroyFrameCount = 0;\n    }\n    public addCount() : void{\n        this.hisTroyFrameCount ++;\n    }\n    public addFrame(frame:any) : void{\n        this.frameList.push(frame);\n    }\n    // 获取帧数据\n    public getLastFrame() : any{\n        return this.frameList.shift();\n    }\n    // 获取帧长度\n    public getFrameCount() : number{\n        return this.frameList.length;\n    }\n    public getIsShowLag() : boolean {\n        return this.isShowLag;\n    }\n    // 返回是否可以循环操作\n    public checkCanWhile() : boolean{\n        return this.getFrameCount() > this.poolNum;\n    }\n    // 检测是否可以更新逻辑 \n    public getCanDoNetFrame(dt):boolean{\n        this.startTime += dt*1000;\n        let frameCount = this.getFrameCount();\n        let candoFrame = false;\n        // 显示菊花\n        // if (this.lagTime > 10 || frameCount > 10) {\n        //     if (!this.nowIsShow) {\n        //         // 这里网络延迟需要显示菊花\n        //         this.isShowLag = true;\n        //         // this.isShowFlower = true;\n        //     }\n        // }\n        // 优化缓冲\n        if (this.startTime >= this.frameTime) {\n            this.startTime -= this.frameTime;\n            if (!this.gameStart && frameCount >= this.poolNum) {\n                this.gameStart = true;\n            }\n            // if (this.isShowFlower) {\n            //     this.isShowFlower = false;\n            //     return;\n            // }\n            // 数据发送\n            if (this.gameStart && frameCount > 0) {\n                this.lagTime = 0;\n                candoFrame = true;\n                this.addCount();\n                // this.doFrame();\n                // while (this.frameList.length > this.poolNum) {\n                //     this.doFrame();\n                // }\n                // 隐藏菊花\n                this.isShowLag = false;\n                // this.hideFlower();\n            } else if (this.gameStart && frameCount === 0) {\n                this.lagTime++;\n            }\n\n        }\n        return candoFrame;\n    }\n}"]}