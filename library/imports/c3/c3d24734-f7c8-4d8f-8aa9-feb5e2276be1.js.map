{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\manager\\public/assets\\manager\\public\\chatsMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\manager\\public","sourcesContent":["import BaseMgr from \"../../framework/baseClass/BaseMgr\";\nimport Package from \"../../framework/net/package\";\nimport { dataids } from \"../../framework/net/dataids\";\nimport { enums } from \"../enums\";\nimport GuildsMgr from \"./guildsMgr\";\n\nimport { chatList, chatItem, chat } from \"../../manager/public/interface/iFriend\";\nimport { date } from \"../../framework/lib/jszip/defaults\";\n\nlet ChannelType = {\n    Channel_World:1,\n    Channel_Guild:2,\n}\n\nexport default class ChatsMgr extends BaseMgr {\n\n    public chatContent:chatList = <chatList>{}\n    public usersInfo = []\n\n    constructor() {\n        super();\n        this.routes = {\n            \"onWorldChat\": this.onWorldChat,\n            \"onGuildChat\": this.onGuildChat,\n\n            \"search.entry.reqUserBrief\": this.search_entry_reqUserBrief,\n        };\n    }\n\n    public search_entry_reqUserBrief(msg: Package): void{\n        let data = msg.getDataByType(dataids.ID_USER_BRIEF);\n        this.usersInfo[data.id] = data\n        \n        //this.gemit(\"chats.updateUserInfo\", data);\n    }\n    \n    // 单例处理\n    private static _instance: ChatsMgr = null;\n    public static getInstance(): ChatsMgr {\n        if (ChatsMgr._instance == null) {\n            ChatsMgr._instance = new ChatsMgr();\n        }\n        return ChatsMgr._instance;\n    }\n\n    public onWorldChat(msg: Package): void{\n        let data = msg.getDataByType(dataids.ID_CHAT_TO_WORLD)\n\n        if(!this.chatContent.list){\n            this.chatContent.list = []\n        }\n\n        let l_chat:chat = <chat>{}\n        l_chat.fromID = data.from\n        l_chat.content = data.content\n\n        if(!this.chatContent.list[ChannelType.Channel_World]){\n            this.chatContent.list[ChannelType.Channel_World] = <chatItem>{}\n            this.chatContent.list[ChannelType.Channel_World].chatContent = []\n        }\n        this.chatContent.list[ChannelType.Channel_World].chatContent.push(l_chat)\n\n        if(!this.usersInfo){\n            this.usersInfo = []\n        }\n\n    }\n\n    public onGuildChat(msg: Package): void{\n        let data = msg.getData()\n\n        if(!this.chatContent.list){\n            this.chatContent.list = []\n        }\n\n        let l_chat:chat = <chat>{}\n        l_chat.fromID = data.from\n        l_chat.content = data.content\n\n        if(!this.chatContent.list[ChannelType.Channel_Guild]){\n            this.chatContent.list[ChannelType.Channel_Guild] = <chatItem>{}\n            this.chatContent.list[ChannelType.Channel_Guild].chatContent = []\n        }\n        this.chatContent.list[ChannelType.Channel_Guild].chatContent.push(l_chat)\n        this.gemit(\"guildChat.recNewChat\", l_chat);\n    }\n\n    public sendReqUserBrief(data:any){\n        let msg = {\n            target:data\n        }\n        this.send_msg(\"search.entry.reqUserBrief\", msg)\n    }\n\n\n    public sendWorldChat(data:any){\n        this.sendChat(\"chat.entry.chatToWorld\", data)\n    }\n\n    public sendGuildChat(data:any){\n        this.sendChat(\"chat.entry.chatToGuild\", data)\n    }\n\n    private sendChat(route:any, data:any){\n        let msg = {\n            content: data\n        }\n        this.send_msg(route, msg)\n    }\n}\n"]}