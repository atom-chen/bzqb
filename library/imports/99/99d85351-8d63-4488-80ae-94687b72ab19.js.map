{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\manager\\public/assets\\manager\\public\\boxMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\manager\\public","sourcesContent":["import BaseMgr from \"../../framework/baseClass/BaseMgr\";\nimport Package from \"../../framework/net/package\";\n\nimport { dataids } from \"../../framework/net/dataids\";\nimport UserMgr from \"./userMgr\";\nimport GameNet from \"../../framework/modules/GameNet\";\nimport { enums } from \"../enums\";\nimport EffectMgr from \"./effectMgr\";\nimport ModuleMgr from \"../../framework/modules/ModuleMgr\";\nlet userMgr = UserMgr.getInstance();\n\nexport default class BoxMgr extends BaseMgr {\n    public boxTable: any = null                     //宝箱表格\n    public levelBoxTable: any = null                     //等级宝箱表格\n    public levelBoxInfo: any = null                     //等级宝箱数据\n    public onlineBox: any;                   //在线宝箱\n    public winBox: any;                   //胜利宝箱\n    public battleBox: any = [];                   //战斗宝箱\n\n    public curBattleBox: any = null                     //当前战斗宝箱\n    public boxReward: { type: number, amount: number }[]  //打开宝箱奖励\n    constructor() {\n        super();\n        this.routes = {\n            'plaza.data.reqBoxes': this.plaza_data_reqBoxes,\n            'plaza.box.reqLevelBox': this.reqLevelBox,\n            'plaza.box.unlockBox': this.plaza_box_unlockBox,\n            'plaza.box.openBox': this.plaza_box_openBox,\n            'plaza.box.buyLevelBox': this.buyLevelBox,\n        };\n    }\n    private plaza_data_reqBoxes(msg: Package): void {\n        let BoxInfo = msg.getDataByType(dataids.ID_BOXLIST);\n        console.log(\"--------宝箱数据-------\", BoxInfo);\n        //查表\n        this.boxTable = this.getConfigSync(\"baoxiang_baoxiang\").json;\n        this.initData(BoxInfo);\n    }\n    sendReqLevelBox() {\n        console.log(\"请求等级宝箱\")\n        let route = 'plaza.box.reqLevelBox';\n        this.send_msg(route);\n    }\n    reqLevelBox(msg: Package): void {\n        this.levelBoxInfo = msg.getDataByType(dataids.ID_GET_LEVELBOX);\n        console.log(\"--------等级宝箱数据-------\", this.levelBoxInfo);\n        this.levelBoxTable = this.getConfigSync(\"LevelBox_LevelBox\").json;\n    }\n    sendBuyLevelBox(level) {\n        console.log(\"请求购买等级宝箱\")\n        let route = 'plaza.box.buyLevelBox';\n        this.send_msg(route, { buyLv: level });\n    }\n    buyLevelBox(msg: Package): void {\n        let diamond = msg.getDataByType(dataids.ID_USER_MONEYSTONE)\n        let rewardInfo = msg.getDataByType(dataids.ID_GET_ALLTYPE_ITEMS)\n        console.log(\"--------购买等级宝箱-------\", diamond, rewardInfo);\n        ModuleMgr.getInstance().showHandleGainBox(rewardInfo);\n    }\n\n    private plaza_box_unlockBox(msg: Package): void {\n        let battleBoxInfo = msg.getDataByType(dataids.ID_UNLOCKBOX);\n        console.log(\"--------开始解锁战斗宝箱-------\", battleBoxInfo);\n        for (let i = 0; i < this.battleBox.length; i++) {\n            if (battleBoxInfo.id == this.battleBox[i].id_service) {\n                this.battleBox[i].unlockTime = battleBoxInfo.unlockTime;\n                break;\n            }\n        }\n    }\n    private plaza_box_openBox(msg: Package): void {\n        cc.log(msg)\n        let id = msg.getDataByType(dataids.ID_OPR_BOXID).id;\n        let getMoney = msg.getDataByType(dataids.ID_GET_MONEY_GOLD).moneyGold;\n        let card = msg.getDataByType(dataids.ID_PRIZE_LIST_TEJI);\n        let newBox = msg.getDataByType(dataids.ID_GET_BOX);\n        userMgr.onlineBoxTimes = msg.getDataByType(dataids.ID_OPEN_TIMES).todayBoxShareTimes;\n        console.log(\"--------打开宝箱-------\", id, getMoney, card, newBox, this.onlineBox.boxTimes);\n        this.deleteBox(id)\n        this.addBox(newBox);\n        if (EffectMgr.getInstance().isInit) {\n            EffectMgr.getInstance().addEffect(card)\n        }\n        let amount = 0;\n        for (let i = 0; i < card.length; i++) {\n            amount += card[i].amount;\n        }\n        this.boxReward = [{ type: enums.Get_Gold, amount: getMoney }, { type: enums.Get_Skill, amount: amount }]\n    }\n\n    //删除宝箱\n    public deleteBox(id: number) {\n        console.log(\"--------删除宝箱-------\", id);\n        if (this.onlineBox.id_service == id) {\n            this.onlineBox = null;\n        }\n        else if (this.winBox.id_service == id) {\n            this.winBox = null;\n        }\n        else {\n            for (let i = 0; i < this.battleBox.length; i++) {\n                if (this.battleBox[i].id_service == id) {\n                    this.battleBox.splice(i, i)\n                    return\n                }\n            }\n        }\n    }\n    //更新宝箱\n    public addBox(boxData: any) {\n        console.log(\"--------增加宝箱-------\", boxData);\n        let box = this.selectBox(boxData.itemId);\n        let obj: any = {\n            id_service: boxData.id,\n            unlockTime: boxData.unlockTime,\n            boxInfo: box,\n        }\n        if (box.boxtype == 1) {\n            obj.boxTimes = userMgr.onlineBoxTimes;\n            this.onlineBox = obj;\n        }\n        else if (box.boxtype == 2) {\n            obj.boxTimes = userMgr.winBoxTimes;\n            this.winBox = obj;\n        }\n        else if (box.boxtype > 3 && box.boxtype < 7) {\n            this.battleBox.push(obj)\n        }\n    }\n\n\n    public initData(data: any): void {\n        for (let i = 0; i < data.length; i++) {\n            this.addBox(data[i])\n        }\n        cc.log(\"----战斗宝箱----\", this.battleBox)\n        cc.log(\"----在线宝箱----\", this.onlineBox)\n        cc.log(\"----胜利宝箱----\", this.winBox)\n        //this.testGm2();\n    }\n    openBox(id: number) {\n        let route = 'plaza.box.openBox';\n        let msg = {\n            'id': id,\n        }\n        this.send_msg(route, msg);\n    }\n    testGm1() {\n        let route = 'plaza.box.gm';\n        let msg = {\n            oprType: 3,//操作类型\n            //解锁加速\n            boxId: 50,//解锁加速宝箱id\n            reduceTime: 100000,//减少解锁时间\n        }\n        this.send_msg(route, msg);\n    }\n    testGm2() {\n        let route = 'plaza.box.gm';\n        let msg = {\n            oprType: 4,//操作类型\n            //解锁加速\n            attrName: 'moneyFen',//玩家属性名\n            attrValue: 10000,//修改后的值\n        }\n        this.send_msg(route, msg);\n    }\n    unlockBox() {\n        this.closeModule(\"battleBox\");\n        let route = 'plaza.box.unlockBox';\n        let msg = {\n            'id': this.curBattleBox.id_service,\n        }\n        this.send_msg(route, msg)\n    }\n\n    public selectBox(id: number): any {\n        for (let i = 0; i < this.boxTable.length; i++) {\n            let box = this.boxTable[i];\n            if (box.id == id) {\n                return box;\n            }\n        }\n        return console.log(\"没有该宝箱id\");\n\n    }\n\n    public setCurBattleBox(index: number) {\n        this.curBattleBox = this.battleBox[index];\n    }\n\n    // 单例处理\n    private static _instance: BoxMgr = null;\n    public static getInstance(): BoxMgr {\n        if (BoxMgr._instance == null) {\n            BoxMgr._instance = new BoxMgr();\n        }\n        return BoxMgr._instance;\n    }\n\n}\n\n"]}