{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\guilds/assets\\modules\\plaza\\script\\guilds\\guildsShopPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\plaza\\script\\guilds","sourcesContent":["import BaseModel from \"../../../../framework/baseClass/BaseModel\";\r\nimport BaseView from \"../../../../framework/baseClass/BaseView\";\r\nimport BaseCtrl from \"../../../../framework/baseClass/BaseCtrl\";\r\nimport ShopMgr from \"../../../../manager/public/shopMgr\";\r\nimport { enums } from \"../../../../manager/enums\";\r\n\r\n/*\r\nauthor: 汤凯\r\n日期:2018-11-22\r\n*/\r\n\r\n//MVC模块,\r\nconst { ccclass, property } = cc._decorator;\r\nlet ctrl: GuildsShopPanelCtrl;\r\n//模型，数据处理\r\nclass Model extends BaseModel {\r\n\tguildShopInfo = ShopMgr.getInstance().getGuildShopInfo();\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tif(!this.guildShopInfo)\r\n\t\t{\r\n\t\t\tShopMgr.getInstance().reqShopInfo(enums.GuildShop_Card);\r\n\t\t}\r\n\t}\r\n}\r\n//视图, 界面显示或动画，在这里完成\r\nclass View extends BaseView {\r\n\tprotected model: Model;\r\n\tprotected node: cc.Node;\r\n\tpublic ui={\r\n\t\tpref_shopItem: ctrl.pref_shopItem,\r\n\t\tlbl_flushCost: ctrl.lbl_flushCost,\r\n\t\tlbl_honorValue: ctrl.lbl_honorValue,\r\n\t\tlbl_tickTime: ctrl.lbl_tickTime,\r\n\t\tbtn_flush: ctrl.btn_flush,\r\n\t\tnode_shopItemContent:ctrl.node_shopItemContent,\r\n\t}\r\n\tconstructor(model){\r\n\t\tsuper(model);\r\n\t\tthis.node = ctrl.node;\r\n\t\tthis.initUi();\r\n\t}\r\n\t//初始化ui\r\n\tpublic initUi() {\r\n\t\tthis.addShopItems();\r\n\t}\r\n\tpublic addShopItems()\r\n\t{\r\n\t\tif(this.model.guildShopInfo&&this.model.guildShopInfo.items) {\r\n\t\t\tfor (let guildShopItemIdx = 0; guildShopItemIdx < this.model.guildShopInfo.items.length; guildShopItemIdx++) {\r\n\t\t\t\tlet shopItemData = this.model.guildShopInfo.items[guildShopItemIdx];\r\n\t\t\t\tlet prefabNode = cc.instantiate(this.ui.pref_shopItem);\r\n\t\t\t\tthis.ui.node_shopItemContent.addChild(prefabNode);\r\n\t\t\t\tprefabNode.getComponent('cardShop').updateDateAndShowCardShop(shopItemData);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tshowTickTime(tickTime)\r\n\t{\r\n\t\tlet hoursCube = Math.floor(tickTime/3600);\r\n\t\tif(hoursCube>=10) {\r\n\t\t\thoursCube = hoursCube.toString();\r\n\t\t}\r\n\t\telse{\r\n\t\t\thoursCube = '0'+hoursCube.toString();\r\n\t\t}\r\n\t\tlet minutesCube = Math.floor(tickTime%3600/60);\r\n\t\tif(minutesCube>=10) {\r\n\t\t\tminutesCube = minutesCube.toString();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tminutesCube = '0'+minutesCube.toString();\r\n\t\t}\r\n\t\tlet secondsCube = Math.floor(tickTime%60);\r\n\t\tif(secondsCube>=10) {\r\n\t\t\tsecondsCube = secondsCube.toString();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tsecondsCube = '0'+secondsCube.toString();\r\n\t\t}\r\n\t\tthis.ui.lbl_tickTime.string = hoursCube+\":\"+minutesCube+\":\"+secondsCube;\r\n\t}\r\n}\r\n//c, 控制\r\n@ccclass\r\nexport default class GuildsShopPanelCtrl extends BaseCtrl {\r\n\tprotected view: View;\r\n\tprotected model: Model;\r\n\t//这边去声明ui组件\r\n\t@property(cc.Prefab)\r\n\tpref_shopItem: cc.Prefab = null;\r\n\t@property(cc.Label)\r\n\tlbl_flushCost: cc.Label = null;\r\n\t@property(cc.Label)\r\n\tlbl_honorValue: cc.Label = null;\r\n\t@property(cc.Label)\r\n\tlbl_tickTime: cc.Label = null;\r\n\t@property(cc.Button)\r\n\tbtn_flush: cc.Button = null;\r\n\t@property(cc.Node)\r\n\tnode_shopItemContent: cc.Node = null;\r\n\t//声明ui组件end\r\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\r\n\r\n\tonLoad (){\r\n\t\t// 控制器\r\n\t\tctrl = this;\r\n\t\t// 创建mvc模式中模型和视图\r\n\t\tthis.initMvc(Model,View);\r\n\t\t//切换前后台需要对定时器进行清理和初始化\r\n        this.schedule(this.countDown.bind(this), 2);\r\n\t}\r\n\r\n\t//定义网络事件\r\n\tprotected defineNetEvents() {\r\n\t \tthis.n_events = {\r\n            'plaza.data.reqShopInfo': this.plaza_data_reqShopInfo,\r\n        };\r\n\t}\r\n\t//定义全局事件\r\n\tprotected defineGlobalEvents() {\r\n\t\tthis.g_events = {};\r\n\t}\r\n\t//绑定操作的回调\r\n\tconnectUi() {\r\n\t\t// this.connect(\"click\",this.ui.btn_close,()=>{\r\n\t\t// \tthis.closeModule(\"guilds\");\r\n\t\t// },\"关闭公会界面\");\r\n\t\tthis.connect(\"click\",this.ui.btn_flush,this.btnFlush.bind(this),\"刷新列表\");\r\n\r\n\t}\r\n\tcountDown()\r\n\t{\r\n\t\tif(this.model.guildShopInfo){\r\n\t        let curTime = new Date().getTime();\r\n\t        let timeGap = Math.floor((curTime - this.model.guildShopInfo.refreshTime)/1000);\r\n\t        if((timeGap)>=enums.GuildShop_RefreshTime)\r\n\t        {\r\n\t\t\t\tShopMgr.getInstance().reqShopInfo(enums.GuildShop_Card);\r\n\t        }\r\n\t        else{\r\n\t        \tthis.view.showTickTime(enums.GuildShop_RefreshTime-timeGap)\r\n\t        }\r\n\t\t}\r\n\t}\r\n\tbtnFlush()\r\n\t{\r\n\t\tShopMgr.getInstance().refreshShop(enums.GuildShop_Card);\r\n\t}\r\n\tplaza_data_reqShopInfo()\r\n\t{\r\n\t\tthis.model.guildShopInfo = ShopMgr.getInstance().getGuildShopInfo();\r\n\t\tthis.view.addShopItems();\r\n\t}\r\n\t//网络事件回调begin\r\n\t//end\r\n\t//全局事件回调begin\r\n\t//end\r\n\t//按钮或任何控件操作的回调begin\r\n\t//end\r\n\r\n\t// update(dt) {}\r\n\r\n\tonDestroy() {\r\n        this.unschedule(this.countDown);\r\n\t\tsuper.onDestroy();\r\n\t}\r\n}"]}