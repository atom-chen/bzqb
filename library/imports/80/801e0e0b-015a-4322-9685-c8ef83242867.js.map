{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\modules\\login\\script/assets\\modules\\login\\script\\login.ts"],"names":[],"mappings":";;;;;AAAA,oEAA+D;AAC/D,kEAA6D;AAC7D,kEAA6D;AAC7D,8DAAyD;AACzD,0DAAqD;AACrD,6DAAwD;AACxD,kEAA6D;AAC7D,kEAA6D;AAC7D,oDAA+C;AAE/C;;;EAGE;AAEF,QAAQ;AACF,IAAA,kBAAqC,EAAnC,oBAAO,EAAE,sBAAQ,CAAmB;AAC5C,IAAI,IAAe,CAAC;AACpB,SAAS;AACT;IAAoB,yBAAS;IAC5B;eACC,iBAAO;IACR,CAAC;IACF,YAAC;AAAD,CAJA,AAIC,CAJmB,mBAAS,GAI5B;AACD,mBAAmB;AACnB;IAAmB,wBAAQ;IAM1B,cAAY,KAAK;QAAjB,YACC,kBAAM,KAAK,CAAC,SAGZ;QAPM,QAAE,GAAG;QACX,SAAS;SACT,CAAA;QAGA,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;QACtB,KAAI,CAAC,MAAM,EAAE,CAAC;;IACf,CAAC;IACD,OAAO;IACA,qBAAM,GAAb;IAEA,CAAC;IACF,WAAC;AAAD,CAfA,AAeC,CAfkB,kBAAQ,GAe1B;AACD,OAAO;AAEP;IAAuC,6BAAQ;IAA/C;;IAkFA,CAAC;IA/EA,WAAW;IACX,WAAW;IACX,6BAA6B;IAE7B,0BAAM,GAAN;QAAA,iBAcC;QAbA,MAAM;QACN,IAAI,GAAG,IAAI,CAAC;QACZ,gBAAgB;QAChB,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;QAC1B,mBAAS,CAAC,WAAW,EAAE,CAAC,WAAW,CAAC;YACnC,QAAQ,EAAE,OAAO,CAAC,eAAe,CAAC;YAClC,QAAQ,EAAE;gBACT,iBAAO,EAAE,CAAC;gBACV,mBAAS,CAAC,WAAW,EAAE,CAAC,iBAAiB,CAAC,UAAC,IAAY;oBACtD,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBACvB,CAAC,CAAC,CAAC;YACJ,CAAC;SACD,CAAC,CAAC;IACJ,CAAC;IAED,QAAQ;IACE,mCAAe,GAAzB;QACC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACpB,CAAC;IACD,QAAQ;IACE,sCAAkB,GAA5B;QACC,IAAI,CAAC,QAAQ,GAAG;YACf,gBAAgB,EAAE,IAAI,CAAC,cAAc;YACrC,gBAAgB,EAAE,IAAI,CAAC,cAAc;SACrC,CAAC;IACH,CAAC;IACD,SAAS;IACT,6BAAS,GAAT;IAEA,CAAC;IACD,aAAa;IACb,KAAK;IACL,aAAa;IACN,kCAAc,GAArB;QACC,kBAAQ,CAAC,WAAW,EAAE,CAAC,iBAAiB,EAAE,CAAC;QAC3C,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;IACrC,CAAC;IAEM,kCAAc,GAArB;QAAA,iBAQC;QAPA,mBAAS,CAAC,WAAW,EAAE,CAAC,UAAU,CAAC;YAClC,OAAO,EAAE,UAAU;YACnB,IAAI,EAAE;gBACL,eAAK,CAAC,WAAW,EAAE,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;gBAClD,KAAI,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;YAClC,CAAC;SACD,CAAC,CAAC;IACJ,CAAC;IACD,KAAK;IACL,mBAAmB;IACnB,KAAK;IACE,8BAAU,GAAjB,UAAkB,IAAY;QAC7B,IAAI,IAAI,IAAI,CAAC,EAAE;YACd,OAAO,CAAC,UAAU,CAAC,iBAAO,CAAC,WAAW,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC;YAC1D,IAAI,UAAU,GAAG,eAAK,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YAC3D,IAAI,UAAU,IAAI,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,EAAE;gBACpD,kBAAQ,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;aACzC;iBAAM;gBACN,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;aACjC;SACD;aAAM;YACN,mBAAS,CAAC,WAAW,EAAE,CAAC,aAAa,EAAE,CAAC;SACxC;IACF,CAAC;IAEO,oCAAgB,GAAxB,UAAyB,IAAS;QAC3B,IAAA,cAAG,EAAE,kBAAK,CAAU;QAC1B,OAAO,OAAO,CAAC,GAAG,IAAI,KAAK,CAAC,CAAC;IAC9B,CAAC;IAED,gBAAgB;IAEhB,6BAAS,GAAT;QACC,iBAAM,SAAS,WAAE,CAAC;IACnB,CAAC;IAjFmB,SAAS;QAD7B,OAAO;OACa,SAAS,CAkF7B;IAAD,gBAAC;CAlFD,AAkFC,CAlFsC,kBAAQ,GAkF9C;kBAlFoB,SAAS","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\modules\\login\\script","sourcesContent":["import BaseModel from \"../../../framework/baseClass/BaseModel\";\r\nimport BaseView from \"../../../framework/baseClass/BaseView\";\r\nimport BaseCtrl from \"../../../framework/baseClass/BaseCtrl\";\r\nimport GameNet from \"../../../framework/modules/GameNet\";\r\nimport Cache from \"../../../framework/modules/Cache\";\r\nimport LoginMgr from \"../../../manager/public/loginMgr\";\r\nimport ModuleMgr from \"../../../framework/modules/ModuleMgr\";\r\nimport ServerMgr from \"../../../framework/modules/ServerMgr\";\r\nimport MgrInit from \"../../../manager/MgrInit\";\r\n\r\n/*\r\nauthor: 张志强\r\n日期:2018-11-01 17:06:58\r\n*/\r\n\r\n//MVC模块,\r\nconst { ccclass, property } = cc._decorator;\r\nlet ctrl: LoginCtrl;\r\n//模型，数据处理\r\nclass Model extends BaseModel {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n}\r\n//视图, 界面显示或动画，在这里完成\r\nclass View extends BaseView {\r\n\tprotected model: Model;\r\n\tprotected node: cc.Node;\r\n\tpublic ui = {\r\n\t\t//在这里声明ui\r\n\t}\r\n\tconstructor(model) {\r\n\t\tsuper(model);\r\n\t\tthis.node = ctrl.node;\r\n\t\tthis.initUi();\r\n\t}\r\n\t//初始化ui\r\n\tpublic initUi(): void {\r\n\r\n\t}\r\n}\r\n//c, 控制\r\n@ccclass\r\nexport default class LoginCtrl extends BaseCtrl {\r\n\tprotected view: View;\r\n\tprotected model: Model;\r\n\t//这边去声明ui组件\r\n\t//声明ui组件end\r\n\t//这是ui组件的map,将ui和控制器或试图普通变量分离\r\n\r\n\tonLoad() {\r\n\t\t// 控制器\r\n\t\tctrl = this;\r\n\t\t// 创建mvc模式中模型和视图\r\n\t\tthis.initMvc(Model, View);\r\n\t\tModuleMgr.getInstance().showLoading({\r\n\t\t\tresPaths: require(\"publicResPath\"),\r\n\t\t\tcomplete: () => {\r\n\t\t\t\tMgrInit();\r\n\t\t\t\tServerMgr.getInstance().loadLoacalSetting((code: number) => {\r\n\t\t\t\t\tthis.loadDataCb(code);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t//定义网络事件\r\n\tprotected defineNetEvents() {\r\n\t\tthis.n_events = {};\r\n\t}\r\n\t//定义全局事件\r\n\tprotected defineGlobalEvents() {\r\n\t\tthis.g_events = {\r\n\t\t\t\"goToCreateRole\": this.goToCreateRole,\r\n\t\t\t\"platTokenError\": this.platTokenError,\r\n\t\t};\r\n\t}\r\n\t//绑定操作的回调\r\n\tconnectUi() {\r\n\r\n\t}\r\n\t//网络事件回调begin\r\n\t//end\r\n\t//全局事件回调begin\r\n\tpublic goToCreateRole(): void {\r\n\t\tLoginMgr.getInstance().getNicknameCfgTab();\r\n\t\tthis.openSubModule(\"registerPanel\");\r\n\t}\r\n\r\n\tpublic platTokenError(): void {\r\n\t\tModuleMgr.getInstance().showMsgBox({\r\n\t\t\tcontent: \"token错误!\",\r\n\t\t\tokcb: () => {\r\n\t\t\t\tCache.getInstance().removeItemByKey(\"loginCache\");\r\n\t\t\t\tthis.openSubModule(\"loginPanel\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t//end\r\n\t//按钮或任何控件操作的回调begin\r\n\t//end\r\n\tpublic loadDataCb(code: number): void {\r\n\t\tif (code == 0) {\r\n\t\t\tplatSdk.setPlatUrl(GameNet.getInstance().getPlatSvrUrl());\r\n\t\t\tlet loginCache = Cache.getInstance().getItem(\"loginCache\");\r\n\t\t\tif (loginCache && this._checkLoginCache(loginCache)) {\r\n\t\t\t\tLoginMgr.getInstance().login(loginCache);\r\n\t\t\t} else {\r\n\t\t\t\tthis.openSubModule(\"loginPanel\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tServerMgr.getInstance().loadSettingCb();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _checkLoginCache(data: any): boolean {\r\n\t\tlet { uid, token } = data;\r\n\t\treturn Boolean(uid && token);\r\n\t}\r\n\r\n\t// update(dt) {}\r\n\r\n\tonDestroy() {\r\n\t\tsuper.onDestroy();\r\n\t}\r\n}"]}