{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\missile/assets\\modules\\game\\script\\missile\\fightBaseMissile.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\modules\\game\\script\\missile","sourcesContent":["import Emitter from \"../../../../framework/modules/Emitter\";\nimport ShootData from \"../modles/ShootData\";\nimport config from \"../common/gameConfig\";\nimport hkRigidBody from \"../physics/hkRigidBody\";\nlet wmCollisionManager = require(\"hkCollisionManager\");\n\nlet emitter = Emitter.getInstance();\n\nconst { fightEvent,colliderConfig,netFrame } = config;\nconst { ccclass, property } = cc._decorator;\nconst hz = 1000/netFrame;\n/*\nauthor: 黄凯\n日期:2018-11-19\n*/\n// 基础导弹\n@ccclass\nexport default class fightBaseMissile extends cc.Component {\n    // 是否绑定相机\n    isBindCarame:boolean;\n    // 伤害\n    power:number;\n    // 座位id\n    seatId:string;\n    // 帧数记录器\n    frameCount:number;\n    // 爆炸后的椭圆范围\n    ellipseRange:number;\n\n    missileBuffType:number;\n    // 延迟时间\n    delay:number = 0;\n    // 父节点\n    fatherNode:cc.Node;\n    // 发射力\n    shootPoi:any;\n    // 刚体\n    rigidBody:hkRigidBody;\n    // 显示\n    onEnable():void{\n    \temitter.on(fightEvent.netFrame,this.netFrame,this);\n    \temitter.on(fightEvent.netUpdate,this.netUpdate,this);\n        let collider = this.getComponent(cc.Collider);\n        if(collider){\n            wmCollisionManager.addCollider(collider);\n        }\n    }\n    // 隐藏\n    onDisable():void{\n        this.remove();\n    }\n    onDestroy(){\n        this.remove();\n    }\n    remove(){\n        emitter.off(fightEvent.netFrame,this);\n        emitter.off(fightEvent.netUpdate,this);\n        let collider = this.getComponent(cc.Collider);\n        if(collider){\n            wmCollisionManager.removeCollider(collider);\n        }\n        // console.log(\"onDisable\")\n    }\n\n    // 设置真实坐标点\n    public setRealPoi(poi:any){\n        poi.x = Math.round(poi.x);\n        poi.y = Math.round(poi.y);\n        this.node[\"realPoi\"].x = poi.x;\n        this.node[\"realPoi\"].y = poi.y;\n        this.node.x = poi.x;\n        this.node.y = poi.y;\n        this.oldX = poi.x;\n        this.oldY = poi.y;\n    }\n\n    // 获取真实坐标点\n    public getRealPoi():any{\n        return this.node[\"realPoi\"];\n    }\n\n    // 初始化\n    // 导弹数据  父节点 通过是否延迟绑定相机 \n    init(shootData:ShootData,fatherNode:cc.Node,shootPoi:any,delay:number = 0){\n        this.frameCount = 0;\n        this.rigidBody = this.getComponent(hkRigidBody);\n        this.node[\"realPoi\"] = {};\n        this.setRealPoi(shootData.startPoi);\n\t\t// this.node.x = shootData.startPoi.x;\n\t\t// this.node.y = shootData.startPoi.y;\n\t\t// this.node[\"realPoi\"].x = Math.round(shootData.startPoi.x);\n\t\t// this.node[\"realPoi\"].y = Math.round(shootData.startPoi.y);\n\t\tthis.power = shootData.power;\n\t\tthis.seatId = shootData.seatId;\n        this.node.parent = fatherNode;\n        this.ellipseRange = shootData.ellipseRange;\n        this.missileBuffType = shootData.missileBuffType;\n\n        // 如果不是延迟炮弹 立即发射\n        if(delay === 0){\n            this.rigidBody.setLineVelocity(shootPoi);\n            this.isBindCarame = true;\n        }else{\n            // 延迟炮弹\n            this.node.opacity = 0;\n            this.delay = delay;\n            this.shootPoi = shootPoi;\n            this.fatherNode = fatherNode;\n            this.rigidBody.bodyEnable = false;\n        }\n\n    }\n\n    // 和地图碰撞时\n    public onMapCollider(){\n\n    }\n\n    // 炮弹死亡 是否是爆炸了\n    dead(isBoomType:boolean,isPlane:boolean = false){\n        // console.log(\"isPlane+++++\",isPlane)\n        emitter.emit(fightEvent.onMissileDead,this,isBoomType,isPlane);\n\n    }\n\n\n    // 飞出场景 碰撞回调\n    wmCollisionExit(otherCollider:cc.Collider,collider:cc.Collider){\n        // console.log(\"otherCollider.tag:\",otherCollider.node.name,\"collider:\",collider.node.name);\n        switch(otherCollider.tag){\n            case colliderConfig.bgBound:\n            // TODO 删除导弹\n            this.dead(false,false);\n            \n            break;\n        }\n    }\n\n    nowFrameTime:number;\n    oldX:number;\n    oldY:number;\n    // 网络帧数驱动\n    netFrame():void{\n        // 如果绑定相机\n        if(this.isBindCarame){\n            emitter.emit(fightEvent.setNowLerpPoi,this.getRealPoi());\n        }\n        // 如果有延迟\n        if(this.delay){\n            this.delay --;\n            if(this.delay === 0){\n                this.delayMissile();\n            }\n        }else{\n            this.frameCount ++;\n        }\n\n        // 插值\n        let realPoi = this.getRealPoi();\n\n        if (this.node && realPoi) {\n            this.nowFrameTime = +new Date();\n            var x = realPoi.x;\n            var y = realPoi.y;\n            this.setRealPoi(this.node);\n            this.node.x = x;\n            this.node.y = y;\n            this.oldX = x;\n            this.oldY = y;\n        }\n\n    }\n\n    // 延迟导弹的发射\n    delayMissile(){\n        this.node.opacity = 255;\n        this.rigidBody.bodyEnable = true;\n        this.rigidBody.setLineVelocity(this.shootPoi);\n    }\n\n\n    // TODO 导弹插值运算\n    netUpdate(dt):void{\n        let realPoi = this.getRealPoi();\n        if (realPoi) {\n            if(this.nowFrameTime){\n                let sd = ((+new Date())-this.nowFrameTime)/hz;\n                sd>1 && (sd = 1);\n                this.node.x = (realPoi.x - this.oldX) * sd+this.oldX;\n                this.node.y = (realPoi.y - this.oldY) * sd+this.oldY;\n            }\n        }\n    }\n}\n\n"]}