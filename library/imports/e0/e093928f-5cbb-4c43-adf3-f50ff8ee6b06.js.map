{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\manager\\public/assets\\manager\\public\\roleMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\manager\\public","sourcesContent":["import BaseMgr from \"../../framework/baseClass/BaseMgr\";\nimport { role } from \"./interface/iRole\";\nimport GameNet from \"../../framework/modules/GameNet\";\nimport Package from \"../../framework/net/package\";\nimport { dataids } from \"../../framework/net/dataids\";\nimport UserMgr from \"./userMgr\";\nimport { enums } from \"../enums\";\n/*\nauthor: 陈斌杰\n日期:2018-11-13 20:03:14\n*/\n\nexport default class RoleMgr extends BaseMgr {\n\tpublic isFirst: boolean = false;\n\tpublic roleCfgTab: any = null;\t\t\t\t\t\t//角色配置表\n\tpublic rolesData: role[] = [];\t\t\t\t\t\t//角色数据\n\tpublic choiceRole: role = null;\t\t\t\t\t\t//当前选择的角色数据\n\tconstructor() {\n\t\tsuper();\n\t\tthis.routes = {\n\t\t\t\"plaza.role.reqRoleList\": this.reqRoleList,\n\t\t\t\"plaza.role.unlockRole\": this.unlockRole,\n\t\t\t\"plaza.role.switchRole\": this.switchRole,\n\t\t};\n\t}\n\n\t// 单例处理\n\tprivate static _instance: RoleMgr = null;\n\tpublic static getInstance(): RoleMgr {\n\t\tif (RoleMgr._instance == null) {\n\t\t\tRoleMgr._instance = new RoleMgr();\n\t\t}\n\t\treturn RoleMgr._instance;\n\t}\n\n\t//向服务器发送角色列表数据请求\n\tpublic sendReqRoleListData(): void {\n\t\tthis.isFirst = true;\n\t\tthis.send_msg(\"plaza.role.reqRoleList\");\n\t}\n\n\t//获取服务器发送的角色列表数据\n\tpublic reqRoleList(msg: Package): void {\n\t\tlet data = msg.getDataByType(dataids.ID_ROLELIST);\n\t\tthis.getCfgTab();\n\t\tthis.initRolesData();\n\t\tthis.setRolesData(data);\n\t\tthis.setUsingRoleData();\n\t}\n\n\t//向服务器发送解锁角色请求\n\tpublic sendReqUnlockRole(roleId: number): void {\n\t\tlet msg = {\n\t\t\titemId: roleId,\n\t\t}\n\t\tthis.send_msg(\"plaza.role.unlockRole\", msg);\n\t}\n\n\t//获取服务器发送的角色解锁数据\n\tpublic unlockRole(msg: Package): void {\n\t\tlet itemData = msg.getDataByType(dataids.ID_ITEM_COUNT);\t\t//碎片解锁需要  设置玩家数据\n\t\tlet unlockRoleData = msg.getDataByType(dataids.ID_UNLOCK_ROLE);\n\t\tthis.setRolesData(unlockRoleData);\n\t}\n\n\t//向服务器发送角色使用请求\n\tpublic sendReqUsingRole(roleId: number): void {\n\t\tlet msg = {\n\t\t\tautoId: roleId,\n\t\t}\n\t\tthis.send_msg(\"plaza.role.switchRole\", msg);\n\t}\n\n\t//获取服务器发送的角色使用数据\n\tpublic switchRole(msg: Package): void {\n\t\tlet itemData = msg.getDataByType(dataids.ID_EQUIP_ROLE);\n\t\tthis.setRoleUsingData(itemData.autoId);\n\t\tthis.setUsingRoleData();\n\t}\n\n\t//获取角色配置表\n\tpublic getCfgTab(): void {\n\t\tthis.roleCfgTab = this.getConfigSync(\"role_juese\").json;\n\t}\n\n\t//初始化角色数据\n\tpublic initRolesData(): void {\n\t\t//初始原始数据\n\t\tfor (let i = 0; i < this.roleCfgTab.length + 1; i++) {\n\t\t\tlet roleData: role = <role>{};\n\t\t\tlet roleCfgData: any = this.roleCfgTab[i];\n\t\t\tif (i == this.roleCfgTab.length) {\n\t\t\t\troleData.roleId = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\troleData.id = null;\n\t\t\troleData.roleId = roleCfgData.roleId;\n\t\t\troleData.isUnlock = false;\n\t\t\troleData.isUsing = false;\n\t\t\tif (roleCfgData.unlock_chip != null) {\n\t\t\t\troleData.itemId = roleCfgData.unlock_chip[0].itemid;\n\t\t\t\troleData.roleChipNum = roleCfgData.unlock_chip[0].count;\n\t\t\t} else {\n\t\t\t\troleData.itemId = null;\n\t\t\t\troleData.roleChipNum = 0;\n\t\t\t}\n\t\t\troleData.userRoleChipNum = 0;\n\t\t\troleData.spendGold = roleCfgData.unlock_gold || 0;\n\t\t\troleData.spendCrystal = roleCfgData.unlock_crystal || 0;\n\t\t\troleData.spendDiamond = roleCfgData.unlock_diamond || 0;\n\t\t\troleData.vipLimite = roleCfgData.unlock_vip || 0;\n\t\t\tthis.rolesData.push(roleData);\n\t\t}\n\t}\n\n\t//设置角色数据\n\tpublic setRolesData(data: any): void {\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tfor (let j = 0; j < this.rolesData.length; j++) {\n\t\t\t\tif (data[i].itemId == this.rolesData[j].roleId) {\n\t\t\t\t\tlet roleData: any = this.getRoleCfgDataByItem(data[i].itemId);\n\t\t\t\t\tthis.rolesData[j].id = data[i].id;\n\t\t\t\t\tthis.rolesData[j].roleId = data[i].itemId;\n\t\t\t\t\tthis.rolesData[j].isUnlock = true;\n\t\t\t\t\tif (roleData.unlock_chip != null) {\n\t\t\t\t\t\tthis.rolesData[j].itemId = roleData.unlock_chip[0].itemid;\n\t\t\t\t\t\tthis.rolesData[j].roleChipNum = roleData.unlock_chip[0].count;\n\t\t\t\t\t}\n\t\t\t\t\tthis.rolesData[j].userRoleChipNum = 0;\n\t\t\t\t\tthis.rolesData[j].spendGold = roleData.unlock_gold;\n\t\t\t\t\tthis.rolesData[j].spendCrystal = roleData.unlock_crystal;\n\t\t\t\t\tthis.rolesData[j].spendDiamond = roleData.unlock_diamond;\n\t\t\t\t\tthis.rolesData[j].vipLimite = roleData.unlock_vip;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//设置当前使用的角色数据\n\tpublic setUsingRoleData(): void {\n\t\tfor (let i = 0; i < this.rolesData.length; i++) {\n\t\t\tlet roleId = UserMgr.getInstance().user.roleId;\n\t\t\tif (roleId == this.rolesData[i].id) {\n\t\t\t\tthis.choiceRole = this.rolesData[i];\n\t\t\t\tthis.choiceRole.id = roleId;\n\t\t\t\tthis.choiceRole.isUsing = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t//设置当前的角色为使用角色\n\tpublic setRoleUsingData(roleId: number): void {\n\t\tfor (let i = 0; i < this.rolesData.length; i++) {\n\t\t\tlet role = this.rolesData[i];\n\t\t\tif (role.id == roleId) {\n\t\t\t\trole.isUsing = true;\n\t\t\t} else {\n\t\t\t\trole.isUsing = false;\n\t\t\t}\n\t\t}\n\t}\n\n\t//根据itemid获取配置表中角色数据\n\tpublic getRoleCfgDataByItem(itemId: number): void {\n\t\tfor (let i = 0; i < this.roleCfgTab.length; i++) {\n\t\t\tlet rolefata = this.roleCfgTab[i];\n\t\t\tif (itemId == rolefata.roleId) {\n\t\t\t\treturn rolefata;\n\t\t\t}\n\t\t}\n\t}\n\n\t//根据itemid获取角色数据\n\tpublic getRoleDataByItem(itemId: number): any {\n\t\tfor (let i = 0; i < this.rolesData.length; i++) {\n\t\t\tlet rolefata = this.rolesData[i];\n\t\t\tif (itemId == rolefata.roleId) {\n\t\t\t\treturn rolefata;\n\t\t\t}\n\t\t}\n\t}\n\n\t//领取邮件奖励获得的特技数据处理\n\tpublic refreshData(data: any): void {\n\t\tif (!this.rolesData || this.rolesData.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let key in data) {\n\t\t\tif (Number(key) == enums.Get_Chip) {\n\t\t\t\tfor (let i = 0; i < data[key].length; i++) {\n\t\t\t\t\tfor (let j = 0; j < this.rolesData.length; j++) {\n\t\t\t\t\t\tlet roleData = this.rolesData[j];\n\t\t\t\t\t\tif (data[key][i].itemId == roleData.itemId) {\n\t\t\t\t\t\t\troleData.userRoleChipNum += data[key][i].amount;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}"]}